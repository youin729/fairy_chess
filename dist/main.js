/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./src/index.ts");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./src/anim.ts":
/*!*********************!*\
  !*** ./src/anim.ts ***!
  \*********************/
/*! exports provided: anim, render */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"anim\", function() { return anim; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"render\", function() { return render; });\n/* harmony import */ var _util__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./util */ \"./src/util.ts\");\nvar __assign = (undefined && undefined.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\n\r\nfunction anim(mutation, state) {\r\n    return state.animation.enabled ? animate(mutation, state) : render(mutation, state);\r\n}\r\nfunction render(mutation, state) {\r\n    var result = mutation(state);\r\n    state.dom.redraw();\r\n    return result;\r\n}\r\nfunction makePiece(key, piece) {\r\n    return {\r\n        key: key,\r\n        pos: _util__WEBPACK_IMPORTED_MODULE_0__[\"key2pos\"](key),\r\n        piece: piece\r\n    };\r\n}\r\nfunction closer(piece, pieces) {\r\n    return pieces.sort(function (p1, p2) {\r\n        return _util__WEBPACK_IMPORTED_MODULE_0__[\"distanceSq\"](piece.pos, p1.pos) - _util__WEBPACK_IMPORTED_MODULE_0__[\"distanceSq\"](piece.pos, p2.pos);\r\n    })[0];\r\n}\r\nfunction animate(mutation, state) {\r\n    // clone state before mutating it\r\n    //盤面を変える前にクローンを作る\r\n    var prevPieces = __assign({}, state.pieces);\r\n    var result = mutation(state);\r\n    var plan = computePlan(prevPieces, state);\r\n    if (!isObjectEmpty(plan.anims) || !isObjectEmpty(plan.fadings)) {\r\n        var alreadyRunning = state.animation.current && state.animation.current.start;\r\n        state.animation.current = {\r\n            start: performance.now(),\r\n            frequency: 1 / state.animation.duration,\r\n            plan: plan\r\n        };\r\n        if (!alreadyRunning)\r\n            step(state, performance.now());\r\n        return;\r\n    }\r\n    else {\r\n        // don't animate, just render right away\r\n        state.dom.redraw();\r\n    }\r\n    return result;\r\n}\r\nfunction computePlan(prevPieces, current) {\r\n    var anims = {}, animedOrigs = [], fadings = {}, missings = [], news = [], prePieces = {};\r\n    var curP, preP, i, vector;\r\n    //現在のpieceをもとに、prePiece配列をつくる\r\n    for (i in prevPieces) {\r\n        prePieces[i] = makePiece(i, prevPieces[i]);\r\n    }\r\n    //すべてのマスに対して \r\n    for (var _i = 0, _a = _util__WEBPACK_IMPORTED_MODULE_0__[\"allKeys\"]; _i < _a.length; _i++) {\r\n        var key = _a[_i];\r\n        curP = current.pieces[key];\r\n        preP = prePieces[key];\r\n        if (curP) {\r\n            if (preP) {\r\n                if (!_util__WEBPACK_IMPORTED_MODULE_0__[\"samePiece\"](curP, preP.piece)) {\r\n                    missings.push(preP);\r\n                    news.push(makePiece(key, curP));\r\n                }\r\n            }\r\n            else\r\n                news.push(makePiece(key, curP));\r\n        }\r\n        else if (preP)\r\n            missings.push(preP);\r\n    }\r\n    news.forEach(function (newP) {\r\n        preP = closer(newP, missings.filter(function (p) { return _util__WEBPACK_IMPORTED_MODULE_0__[\"samePiece\"](newP.piece, p.piece); }));\r\n        if (preP) {\r\n            vector = [preP.pos[0] - newP.pos[0], preP.pos[1] - newP.pos[1]];\r\n            anims[newP.key] = vector.concat(vector);\r\n            animedOrigs.push(preP.key);\r\n        }\r\n    });\r\n    missings.forEach(function (p) {\r\n        if (!_util__WEBPACK_IMPORTED_MODULE_0__[\"containsX\"](animedOrigs, p.key))\r\n            fadings[p.key] = p.piece;\r\n    });\r\n    return {\r\n        anims: anims,\r\n        fadings: fadings\r\n    };\r\n}\r\nfunction step(state, now) {\r\n    var cur = state.animation.current;\r\n    if (cur === undefined) { // animation was canceled :(\r\n        if (!state.dom.destroyed)\r\n            state.dom.redrawNow();\r\n        return;\r\n    }\r\n    var rest = 1 - (now - cur.start) * cur.frequency;\r\n    if (rest <= 0) {\r\n        state.animation.current = undefined;\r\n        state.dom.redrawNow();\r\n    }\r\n    else {\r\n        var ease = easing(rest);\r\n        for (var i in cur.plan.anims) {\r\n            var cfg = cur.plan.anims[i];\r\n            cfg[2] = cfg[0] * ease;\r\n            cfg[3] = cfg[1] * ease;\r\n        }\r\n        state.dom.redrawNow(true); // optimisation: don't render SVG changes during animations\r\n        requestAnimationFrame(function (now) {\r\n            if (now === void 0) { now = performance.now(); }\r\n            return step(state, now);\r\n        });\r\n    }\r\n}\r\nfunction isObjectEmpty(o) {\r\n    for (var _ in o)\r\n        return false;\r\n    return true;\r\n}\r\n// https://gist.github.com/gre/1650294\r\nfunction easing(t) {\r\n    return t < 0.5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;\r\n}\r\n\n\n//# sourceURL=webpack:///./src/anim.ts?");

/***/ }),

/***/ "./src/api.ts":
/*!********************!*\
  !*** ./src/api.ts ***!
  \********************/
/*! exports provided: start */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"start\", function() { return start; });\n/* harmony import */ var _anim__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./anim */ \"./src/anim.ts\");\n/* harmony import */ var _board__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./board */ \"./src/board.ts\");\n/* harmony import */ var _drag__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./drag */ \"./src/drag.ts\");\n\r\n\r\n\r\nfunction start(state, redrawAll) {\r\n    //白番か黒番かを確認する\r\n    function toggleOrientation() {\r\n        _board__WEBPACK_IMPORTED_MODULE_1__[\"toggleOrientation\"](state);\r\n        redrawAll();\r\n    }\r\n    ;\r\n    return {\r\n        state: state,\r\n        //getFen: () => fenWrite(state.pieces),\r\n        toggleOrientation: toggleOrientation,\r\n        /*\r\n            setPieces(pieces) {\r\n              anim(state => board.setPieces(state, pieces), state);\r\n            },\r\n        */\r\n        selectSquare: function (key, force) {\r\n            if (key)\r\n                Object(_anim__WEBPACK_IMPORTED_MODULE_0__[\"anim\"])(function (state) { return _board__WEBPACK_IMPORTED_MODULE_1__[\"selectSquare\"](state, key, force); }, state);\r\n            else if (state.selected) {\r\n                _board__WEBPACK_IMPORTED_MODULE_1__[\"unselect\"](state);\r\n                state.dom.redraw();\r\n            }\r\n        },\r\n        move: function (orig, dest) {\r\n            Object(_anim__WEBPACK_IMPORTED_MODULE_0__[\"anim\"])(function (state) { return _board__WEBPACK_IMPORTED_MODULE_1__[\"baseMove\"](state, orig, dest); }, state);\r\n        },\r\n        newPiece: function (piece, key) {\r\n            Object(_anim__WEBPACK_IMPORTED_MODULE_0__[\"anim\"])(function (state) { return _board__WEBPACK_IMPORTED_MODULE_1__[\"baseNewPiece\"](state, piece, key); }, state);\r\n        },\r\n        playPremove: function () {\r\n            if (state.premovable.current) {\r\n                if (Object(_anim__WEBPACK_IMPORTED_MODULE_0__[\"anim\"])(_board__WEBPACK_IMPORTED_MODULE_1__[\"playPremove\"], state))\r\n                    return true;\r\n                // if the premove couldn't be played, redraw to clear it up\r\n                state.dom.redraw();\r\n            }\r\n            return false;\r\n        },\r\n        /*\r\n            playPredrop(validate) {\r\n              if (state.predroppable.current) {\r\n                const result = board.playPredrop(state, validate);\r\n                state.dom.redraw();\r\n                return result;\r\n              }\r\n              return false;\r\n            },\r\n        */\r\n        cancelPremove: function () {\r\n            Object(_anim__WEBPACK_IMPORTED_MODULE_0__[\"render\"])(_board__WEBPACK_IMPORTED_MODULE_1__[\"unsetPremove\"], state);\r\n        },\r\n        /*\r\n            cancelPredrop() {\r\n              render(board.unsetPredrop, state);\r\n            },\r\n        */\r\n        cancelMove: function () {\r\n            Object(_anim__WEBPACK_IMPORTED_MODULE_0__[\"render\"])(function (state) { _board__WEBPACK_IMPORTED_MODULE_1__[\"cancelMove\"](state); Object(_drag__WEBPACK_IMPORTED_MODULE_2__[\"cancel\"])(state); }, state);\r\n        },\r\n        stop: function () {\r\n            Object(_anim__WEBPACK_IMPORTED_MODULE_0__[\"render\"])(function (state) { _board__WEBPACK_IMPORTED_MODULE_1__[\"stop\"](state); Object(_drag__WEBPACK_IMPORTED_MODULE_2__[\"cancel\"])(state); }, state);\r\n        },\r\n        /*\r\n            explode(keys: cg.Key[]) {\r\n              explosion(state, keys);\r\n            },\r\n        */\r\n        setAutoShapes: function (shapes) {\r\n            Object(_anim__WEBPACK_IMPORTED_MODULE_0__[\"render\"])(function (state) { return state.drawable.autoShapes = shapes; }, state);\r\n        },\r\n        setShapes: function (shapes) {\r\n            Object(_anim__WEBPACK_IMPORTED_MODULE_0__[\"render\"])(function (state) { return state.drawable.shapes = shapes; }, state);\r\n        },\r\n        getKeyAtDomPos: function (pos) {\r\n            return _board__WEBPACK_IMPORTED_MODULE_1__[\"getKeyAtDomPos\"](pos, _board__WEBPACK_IMPORTED_MODULE_1__[\"whitePov\"](state), state.dom.bounds());\r\n        },\r\n        redrawAll: redrawAll,\r\n    };\r\n}\r\n\n\n//# sourceURL=webpack:///./src/api.ts?");

/***/ }),

/***/ "./src/board.ts":
/*!**********************!*\
  !*** ./src/board.ts ***!
  \**********************/
/*! exports provided: getKeyAtDomPos, toggleOrientation, callUserFunction, selectSquare, setSelected, baseNewPiece, playPremove, unsetPremove, unselect, baseMove, cancelMove, userMove, setCheck, unsetPredrop, isDraggable, canMove, stop, whitePov */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getKeyAtDomPos\", function() { return getKeyAtDomPos; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"toggleOrientation\", function() { return toggleOrientation; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"callUserFunction\", function() { return callUserFunction; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"selectSquare\", function() { return selectSquare; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"setSelected\", function() { return setSelected; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"baseNewPiece\", function() { return baseNewPiece; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"playPremove\", function() { return playPremove; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"unsetPremove\", function() { return unsetPremove; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"unselect\", function() { return unselect; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"baseMove\", function() { return baseMove; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"cancelMove\", function() { return cancelMove; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"userMove\", function() { return userMove; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"setCheck\", function() { return setCheck; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"unsetPredrop\", function() { return unsetPredrop; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"isDraggable\", function() { return isDraggable; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"canMove\", function() { return canMove; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"stop\", function() { return stop; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"whitePov\", function() { return whitePov; });\n/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./types */ \"./src/types.ts\");\n/* harmony import */ var _premove__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./premove */ \"./src/premove.ts\");\n/* harmony import */ var _util__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./util */ \"./src/util.ts\");\n\r\n\r\n\r\n\r\nfunction getKeyAtDomPos(pos, asWhite, bounds) {\r\n    var file = Math.ceil(_types__WEBPACK_IMPORTED_MODULE_0__[\"size\"] * ((pos[0] - bounds.left) / bounds.width));\r\n    if (!asWhite)\r\n        file = (_types__WEBPACK_IMPORTED_MODULE_0__[\"size\"] + 1) - file;\r\n    var rank = Math.ceil(_types__WEBPACK_IMPORTED_MODULE_0__[\"size\"] - (_types__WEBPACK_IMPORTED_MODULE_0__[\"size\"] * ((pos[1] - bounds.top) / bounds.height)));\r\n    if (!asWhite)\r\n        rank = (_types__WEBPACK_IMPORTED_MODULE_0__[\"size\"] + 1) - rank;\r\n    return (file > 0 && file <= _types__WEBPACK_IMPORTED_MODULE_0__[\"size\"] && rank > 0 && rank <= _types__WEBPACK_IMPORTED_MODULE_0__[\"size\"]) ? Object(_util__WEBPACK_IMPORTED_MODULE_2__[\"pos2key\"])([file, rank]) : undefined;\r\n}\r\nfunction toggleOrientation(state) {\r\n    state.orientation = Object(_util__WEBPACK_IMPORTED_MODULE_2__[\"opposite\"])(state.orientation);\r\n    state.animation.current =\r\n        state.draggable.current =\r\n            state.selected = undefined;\r\n}\r\nfunction callUserFunction(f) {\r\n    var args = [];\r\n    for (var _i = 1; _i < arguments.length; _i++) {\r\n        args[_i - 1] = arguments[_i];\r\n    }\r\n    if (f)\r\n        setTimeout(function () { return f.apply(void 0, args); }, 1);\r\n}\r\nfunction selectSquare(state, key, force) {\r\n    callUserFunction(state.events.select, key);\r\n    if (state.selected) {\r\n        if (state.selected === key && !state.draggable.enabled) {\r\n            unselect(state);\r\n            state.hold.cancel();\r\n            return;\r\n        }\r\n        else if ((state.selectable.enabled || force) && state.selected !== key) {\r\n            if (userMove(state, state.selected, key)) {\r\n                state.stats.dragged = false;\r\n                return;\r\n            }\r\n        }\r\n    }\r\n    if (isMovable(state, key) || isPremovable(state, key)) {\r\n        setSelected(state, key);\r\n        state.hold.start();\r\n    }\r\n}\r\nfunction setSelected(state, key) {\r\n    state.selected = key;\r\n    if (isPremovable(state, key)) {\r\n        state.premovable.dests = Object(_premove__WEBPACK_IMPORTED_MODULE_1__[\"default\"])(state.pieces, key, state.premovable.castle);\r\n    }\r\n    else\r\n        state.premovable.dests = undefined;\r\n}\r\nfunction baseNewPiece(state, piece, key, force) {\r\n    if (state.pieces[key]) {\r\n        if (force)\r\n            delete state.pieces[key];\r\n        else\r\n            return false;\r\n    }\r\n    callUserFunction(state.events.dropNewPiece, piece, key);\r\n    state.pieces[key] = piece;\r\n    state.lastMove = [key];\r\n    state.check = undefined;\r\n    callUserFunction(state.events.change);\r\n    state.movable.dests = undefined;\r\n    state.turnColor = Object(_util__WEBPACK_IMPORTED_MODULE_2__[\"opposite\"])(state.turnColor);\r\n    return true;\r\n}\r\nfunction playPremove(state) {\r\n    var move = state.premovable.current;\r\n    if (!move)\r\n        return false;\r\n    var orig = move[0], dest = move[1];\r\n    var success = false;\r\n    if (canMove(state, orig, dest)) {\r\n        var result = baseUserMove(state, orig, dest);\r\n        if (result) {\r\n            var metadata = { premove: true };\r\n            if (result !== true)\r\n                metadata.captured = result;\r\n            callUserFunction(state.movable.events.after, orig, dest, metadata);\r\n            success = true;\r\n        }\r\n    }\r\n    unsetPremove(state);\r\n    return success;\r\n}\r\nfunction isMovable(state, orig) {\r\n    var piece = state.pieces[orig];\r\n    return !!piece && (state.movable.color === 'both' || (state.movable.color === piece.color &&\r\n        state.turnColor === piece.color));\r\n}\r\nfunction isPremovable(state, orig) {\r\n    var piece = state.pieces[orig];\r\n    return !!piece && state.premovable.enabled &&\r\n        state.movable.color === piece.color &&\r\n        state.turnColor !== piece.color;\r\n}\r\nfunction unsetPremove(state) {\r\n    if (state.premovable.current) {\r\n        state.premovable.current = undefined;\r\n        callUserFunction(state.premovable.events.unset);\r\n    }\r\n}\r\nfunction unselect(state) {\r\n    state.selected = undefined;\r\n    state.premovable.dests = undefined;\r\n    state.hold.cancel();\r\n}\r\nfunction baseMove(state, orig, dest) {\r\n    var origPiece = state.pieces[orig], destPiece = state.pieces[dest];\r\n    if (orig === dest || !origPiece)\r\n        return false;\r\n    var captured = (destPiece && destPiece.color !== origPiece.color) ? destPiece : undefined;\r\n    if (dest == state.selected)\r\n        unselect(state);\r\n    callUserFunction(state.events.move, orig, dest, captured);\r\n    state.pieces[dest] = origPiece;\r\n    delete state.pieces[orig];\r\n    state.lastMove = [orig, dest];\r\n    state.check = undefined;\r\n    callUserFunction(state.events.change);\r\n    return captured || true;\r\n}\r\nfunction baseUserMove(state, orig, dest) {\r\n    var result = baseMove(state, orig, dest);\r\n    if (result) {\r\n        state.movable.dests = undefined;\r\n        state.turnColor = Object(_util__WEBPACK_IMPORTED_MODULE_2__[\"opposite\"])(state.turnColor);\r\n        state.animation.current = undefined;\r\n    }\r\n    return result;\r\n}\r\nfunction cancelMove(state) {\r\n    unsetPremove(state);\r\n    unsetPredrop(state);\r\n    unselect(state);\r\n}\r\nfunction userMove(state, orig, dest) {\r\n    if (canMove(state, orig, dest)) {\r\n        var result = baseUserMove(state, orig, dest);\r\n        if (result) {\r\n            var holdTime = state.hold.stop();\r\n            unselect(state);\r\n            var metadata = {\r\n                premove: false,\r\n                ctrlKey: state.stats.ctrlKey,\r\n                holdTime: holdTime\r\n            };\r\n            if (result !== true)\r\n                metadata.captured = result;\r\n            callUserFunction(state.movable.events.after, orig, dest, metadata);\r\n            return true;\r\n        }\r\n    }\r\n    else if (canPremove(state, orig, dest)) {\r\n        setPremove(state, orig, dest, {\r\n            ctrlKey: state.stats.ctrlKey\r\n        });\r\n        unselect(state);\r\n        return true;\r\n    }\r\n    unselect(state);\r\n    return false;\r\n}\r\nfunction setCheck(state, color) {\r\n    state.check = undefined;\r\n    if (color === true)\r\n        color = state.turnColor;\r\n    if (color)\r\n        for (var k in state.pieces) {\r\n            if (state.pieces[k].role === '1' && state.pieces[k].color === color) {\r\n                state.check = k;\r\n            }\r\n        }\r\n}\r\nfunction setPremove(state, orig, dest, meta) {\r\n    unsetPredrop(state);\r\n    state.premovable.current = [orig, dest];\r\n    callUserFunction(state.premovable.events.set, orig, dest, meta);\r\n}\r\nfunction unsetPredrop(state) {\r\n    var pd = state.predroppable;\r\n    if (pd.current) {\r\n        pd.current = undefined;\r\n        callUserFunction(pd.events.unset);\r\n    }\r\n}\r\nfunction isDraggable(state, orig) {\r\n    var piece = state.pieces[orig];\r\n    return !!piece && state.draggable.enabled && (state.movable.color === 'both' || (state.movable.color === piece.color && (state.turnColor === piece.color || state.premovable.enabled)));\r\n}\r\nfunction canMove(state, orig, dest) {\r\n    return orig !== dest && isMovable(state, orig) && (state.movable.free || (!!state.movable.dests && Object(_util__WEBPACK_IMPORTED_MODULE_2__[\"containsX\"])(state.movable.dests[orig], dest)));\r\n}\r\nfunction stop(state) {\r\n    state.movable.color =\r\n        state.movable.dests =\r\n            state.animation.current = undefined;\r\n    cancelMove(state);\r\n}\r\nfunction canPremove(state, orig, dest) {\r\n    return orig !== dest &&\r\n        isPremovable(state, orig) &&\r\n        Object(_util__WEBPACK_IMPORTED_MODULE_2__[\"containsX\"])(Object(_premove__WEBPACK_IMPORTED_MODULE_1__[\"default\"])(state.pieces, orig, state.premovable.castle), dest);\r\n}\r\nfunction whitePov(s) {\r\n    return s.orientation === 'white';\r\n}\r\n\n\n//# sourceURL=webpack:///./src/board.ts?");

/***/ }),

/***/ "./src/chessground.ts":
/*!****************************!*\
  !*** ./src/chessground.ts ***!
  \****************************/
/*! exports provided: Chessground */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Chessground\", function() { return Chessground; });\n/* harmony import */ var _api__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./api */ \"./src/api.ts\");\n/* harmony import */ var _wrap__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./wrap */ \"./src/wrap.ts\");\n/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./config */ \"./src/config.ts\");\n/* harmony import */ var _state__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./state */ \"./src/state.ts\");\n/* harmony import */ var _render__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./render */ \"./src/render.ts\");\n/* harmony import */ var _util__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./util */ \"./src/util.ts\");\n/* harmony import */ var _events__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./events */ \"./src/events.ts\");\n/* harmony import */ var _svg__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./svg */ \"./src/svg.ts\");\n/* harmony import */ var _move__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./move */ \"./src/move.ts\");\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n////////// chess ground ////////////\r\nfunction move(state) {\r\n    var dests = {};\r\n    for (var _i = 0, _a = _util__WEBPACK_IMPORTED_MODULE_5__[\"allKeys\"]; _i < _a.length; _i++) {\r\n        var c = _a[_i];\r\n        if (state.pieces[c] && state.pieces[c].color === state.orientation) {\r\n            dests[c] = Object(_move__WEBPACK_IMPORTED_MODULE_8__[\"legalMove\"])(state.pieces, c);\r\n        }\r\n    }\r\n    return dests;\r\n}\r\nfunction Chessground(element, config) {\r\n    var state = Object(_state__WEBPACK_IMPORTED_MODULE_3__[\"defaults\"])();\r\n    Object(_config__WEBPACK_IMPORTED_MODULE_2__[\"configure\"])(state, config || {});\r\n    state.movable.dests = move(state);\r\n    function redrawAll() {\r\n        var prevUnbind = state.dom && state.dom.unbind;\r\n        var relative = state.viewOnly && !state.drawable.visible, elements = Object(_wrap__WEBPACK_IMPORTED_MODULE_1__[\"default\"])(element, state, relative), bounds = _util__WEBPACK_IMPORTED_MODULE_5__[\"memo\"](function () { return elements.board.getBoundingClientRect(); });\r\n        var redrawNow = function (skipSvg) {\r\n            Object(_render__WEBPACK_IMPORTED_MODULE_4__[\"default\"])(state);\r\n            if (!skipSvg && elements.svg)\r\n                _svg__WEBPACK_IMPORTED_MODULE_7__[\"renderSvg\"](state, elements.svg);\r\n        };\r\n        state.dom = {\r\n            elements: elements,\r\n            bounds: bounds,\r\n            redraw: debounceRedraw(redrawNow),\r\n            redrawNow: redrawNow,\r\n            unbind: prevUnbind,\r\n            relative: relative\r\n        };\r\n        redrawNow(false);\r\n        //events\r\n        _events__WEBPACK_IMPORTED_MODULE_6__[\"bindBoard\"](state);\r\n        if (!prevUnbind)\r\n            state.dom.unbind = _events__WEBPACK_IMPORTED_MODULE_6__[\"bindDocument\"](state, redrawAll);\r\n        state.events.insert && state.events.insert(elements);\r\n    }\r\n    redrawAll();\r\n    return Object(_api__WEBPACK_IMPORTED_MODULE_0__[\"start\"])(state, redrawAll);\r\n}\r\nfunction debounceRedraw(redrawNow) {\r\n    var redrawing = false;\r\n    return function () {\r\n        if (redrawing)\r\n            return;\r\n        redrawing = true;\r\n        requestAnimationFrame(function () {\r\n            redrawNow();\r\n            redrawing = false;\r\n        });\r\n    };\r\n}\r\n\n\n//# sourceURL=webpack:///./src/chessground.ts?");

/***/ }),

/***/ "./src/config.ts":
/*!***********************!*\
  !*** ./src/config.ts ***!
  \***********************/
/*! exports provided: configure */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"configure\", function() { return configure; });\n/* harmony import */ var _board__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./board */ \"./src/board.ts\");\n/* harmony import */ var _fen__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./fen */ \"./src/fen.ts\");\n\r\n\r\nfunction configure(state, config) {\r\n    // don't merge destinations. Just override.\r\n    if (config.movable && config.movable.dests)\r\n        state.movable.dests = undefined;\r\n    merge(state, config);\r\n    // if a fen was provided, replace the pieces\r\n    if (config.fen) {\r\n        state.pieces = Object(_fen__WEBPACK_IMPORTED_MODULE_1__[\"read\"])(config.fen);\r\n        state.drawable.shapes = [];\r\n    }\r\n    // apply config values that could be undefined yet meaningful\r\n    if (config.hasOwnProperty('check'))\r\n        Object(_board__WEBPACK_IMPORTED_MODULE_0__[\"setCheck\"])(state, config.check || false);\r\n    if (config.hasOwnProperty('lastMove') && !config.lastMove)\r\n        state.lastMove = undefined;\r\n    // in case of ZH drop last move, there's a single square.\r\n    // if the previous last move had two squares,\r\n    // the merge algorithm will incorrectly keep the second square.\r\n    else if (config.lastMove)\r\n        state.lastMove = config.lastMove;\r\n    // fix move/premove dests\r\n    if (state.selected)\r\n        Object(_board__WEBPACK_IMPORTED_MODULE_0__[\"setSelected\"])(state, state.selected);\r\n    // no need for such short animations\r\n    if (!state.animation.duration || state.animation.duration < 100)\r\n        state.animation.enabled = false;\r\n    /*\r\n    if (!state.movable.rookCastle && state.movable.dests) {\r\n      const rank = state.movable.color === 'white' ? 1 : 8,\r\n      kingStartPos = 'e' + rank,\r\n      dests = state.movable.dests[kingStartPos],\r\n      king = state.pieces[kingStartPos];\r\n      if (!dests || !king || king.role !== 'king') return;\r\n      state.movable.dests[kingStartPos] = dests.filter(d =>\r\n        !((d === 'a' + rank) && dests.indexOf('c' + rank as cg.Key) !== -1) &&\r\n          !((d === 'h' + rank) && dests.indexOf('g' + rank as cg.Key) !== -1)\r\n      );\r\n    }\r\n    */\r\n}\r\n;\r\nfunction merge(base, extend) {\r\n    for (var key in extend) {\r\n        if (isObject(base[key]) && isObject(extend[key]))\r\n            merge(base[key], extend[key]);\r\n        else\r\n            base[key] = extend[key];\r\n    }\r\n}\r\nfunction isObject(o) {\r\n    return typeof o === 'object';\r\n}\r\n\n\n//# sourceURL=webpack:///./src/config.ts?");

/***/ }),

/***/ "./src/drag.ts":
/*!*********************!*\
  !*** ./src/drag.ts ***!
  \*********************/
/*! exports provided: start, move, end, pieceCloseTo, cancel */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"start\", function() { return start; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"move\", function() { return move; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"end\", function() { return end; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"pieceCloseTo\", function() { return pieceCloseTo; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"cancel\", function() { return cancel; });\n/* harmony import */ var _board__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./board */ \"./src/board.ts\");\n/* harmony import */ var _util__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./util */ \"./src/util.ts\");\n/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./types */ \"./src/types.ts\");\n/* harmony import */ var _draw__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./draw */ \"./src/draw.ts\");\n/* harmony import */ var _anim__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./anim */ \"./src/anim.ts\");\n\r\n\r\n\r\n\r\n\r\nfunction start(s, e) {\r\n    if (e.button !== undefined && e.button !== 0)\r\n        return; // only touch or left click\r\n    if (e.touches && e.touches.length > 1)\r\n        return; // support one finger touch only\r\n    //座標を特定\r\n    var bounds = s.dom.bounds(), position = _util__WEBPACK_IMPORTED_MODULE_1__[\"eventPosition\"](e), orig = _board__WEBPACK_IMPORTED_MODULE_0__[\"getKeyAtDomPos\"](position, _board__WEBPACK_IMPORTED_MODULE_0__[\"whitePov\"](s), bounds);\r\n    if (!orig)\r\n        return;\r\n    var piece = s.pieces[orig];\r\n    var previouslySelected = s.selected;\r\n    if (!previouslySelected && s.drawable.enabled && (s.drawable.eraseOnClick || (!piece || piece.color !== s.turnColor)))\r\n        Object(_draw__WEBPACK_IMPORTED_MODULE_3__[\"clear\"])(s);\r\n    // Prevent touch scroll and create no corresponding mouse event, if there\r\n    // is an intent to interact with the board. If no color is movable\r\n    // (and the board is not for viewing only), touches are likely intended to\r\n    // select squares.\r\n    if (e.cancelable !== false &&\r\n        (!e.touches || !s.movable.color || piece || previouslySelected || pieceCloseTo(s, position)))\r\n        e.preventDefault();\r\n    var hadPremove = !!s.premovable.current;\r\n    var hadPredrop = !!s.predroppable.current;\r\n    //s.stats.ctrlKey = e.ctrlKey;\r\n    if (s.selected && _board__WEBPACK_IMPORTED_MODULE_0__[\"canMove\"](s, s.selected, orig)) {\r\n        Object(_anim__WEBPACK_IMPORTED_MODULE_4__[\"anim\"])(function (state) { return _board__WEBPACK_IMPORTED_MODULE_0__[\"selectSquare\"](state, orig); }, s);\r\n    }\r\n    else {\r\n        _board__WEBPACK_IMPORTED_MODULE_0__[\"selectSquare\"](s, orig);\r\n    }\r\n    var stillSelected = s.selected === orig;\r\n    var element = pieceElementByKey(s, orig);\r\n    if (piece && element && stillSelected && _board__WEBPACK_IMPORTED_MODULE_0__[\"isDraggable\"](s, orig)) {\r\n        var squareBounds = computeSquareBounds(orig, _board__WEBPACK_IMPORTED_MODULE_0__[\"whitePov\"](s), bounds);\r\n        s.draggable.current = {\r\n            orig: orig,\r\n            origPos: _util__WEBPACK_IMPORTED_MODULE_1__[\"key2pos\"](orig),\r\n            piece: piece,\r\n            rel: position,\r\n            epos: position,\r\n            pos: [0, 0],\r\n            dec: s.draggable.centerPiece ? [\r\n                position[0] - (squareBounds.left + squareBounds.width / 2),\r\n                position[1] - (squareBounds.top + squareBounds.height / 2)\r\n            ] : [0, 0],\r\n            started: s.draggable.autoDistance && s.stats.dragged,\r\n            element: element,\r\n            previouslySelected: previouslySelected,\r\n            originTarget: e.target\r\n        };\r\n        element.cgDragging = true;\r\n        element.classList.add('dragging');\r\n        // place ghost\r\n        var ghost = s.dom.elements.ghost;\r\n        if (ghost) {\r\n            ghost.className = \"ghost \" + piece.color + \" \" + piece.role;\r\n            _util__WEBPACK_IMPORTED_MODULE_1__[\"translateAbs\"](ghost, _util__WEBPACK_IMPORTED_MODULE_1__[\"posToTranslateAbs\"](bounds)(_util__WEBPACK_IMPORTED_MODULE_1__[\"key2pos\"](orig), _board__WEBPACK_IMPORTED_MODULE_0__[\"whitePov\"](s)));\r\n            _util__WEBPACK_IMPORTED_MODULE_1__[\"setVisible\"](ghost, true);\r\n        }\r\n        processDrag(s);\r\n    }\r\n    else {\r\n        if (hadPremove)\r\n            _board__WEBPACK_IMPORTED_MODULE_0__[\"unsetPremove\"](s);\r\n        if (hadPredrop)\r\n            _board__WEBPACK_IMPORTED_MODULE_0__[\"unsetPredrop\"](s);\r\n    }\r\n    s.dom.redraw();\r\n}\r\nfunction move(s, e) {\r\n    // support one finger touch only\r\n    if (s.draggable.current && (!e.touches || e.touches.length < 2)) {\r\n        s.draggable.current.epos = _util__WEBPACK_IMPORTED_MODULE_1__[\"eventPosition\"](e);\r\n    }\r\n}\r\nfunction end(s, e) {\r\n    var cur = s.draggable.current;\r\n    if (!cur)\r\n        return;\r\n    // create no corresponding mouse event\r\n    if (e.type === 'touchend' && e.cancelable !== false)\r\n        e.preventDefault();\r\n    // comparing with the origin target is an easy way to test that the end event\r\n    // has the same touch origin\r\n    if (e.type === 'touchend' && cur && cur.originTarget !== e.target && !cur.newPiece) {\r\n        s.draggable.current = undefined;\r\n        return;\r\n    }\r\n    _board__WEBPACK_IMPORTED_MODULE_0__[\"unsetPremove\"](s);\r\n    _board__WEBPACK_IMPORTED_MODULE_0__[\"unsetPredrop\"](s);\r\n    // touchend has no position; so use the last touchmove position instead\r\n    var eventPos = _util__WEBPACK_IMPORTED_MODULE_1__[\"eventPosition\"](e) || cur.epos;\r\n    var dest = _board__WEBPACK_IMPORTED_MODULE_0__[\"getKeyAtDomPos\"](eventPos, _board__WEBPACK_IMPORTED_MODULE_0__[\"whitePov\"](s), s.dom.bounds());\r\n    if (dest && cur.started && cur.orig !== dest) {\r\n        s.stats.ctrlKey = e.ctrlKey;\r\n        if (_board__WEBPACK_IMPORTED_MODULE_0__[\"userMove\"](s, cur.orig, dest))\r\n            s.stats.dragged = true;\r\n        /*if (cur.newPiece) board.dropNewPiece(s, cur.orig, dest, cur.force);\r\n        else {\r\n          s.stats.ctrlKey = e.ctrlKey;\r\n          if (board.userMove(s, cur.orig, dest)) s.stats.dragged = true;\r\n        }*/\r\n    }\r\n    else if (cur.newPiece) {\r\n        delete s.pieces[cur.orig];\r\n    }\r\n    else if (s.draggable.deleteOnDropOff && !dest) {\r\n        delete s.pieces[cur.orig];\r\n        _board__WEBPACK_IMPORTED_MODULE_0__[\"callUserFunction\"](s.events.change);\r\n    }\r\n    if (cur && cur.orig === cur.previouslySelected && (cur.orig === dest || !dest))\r\n        _board__WEBPACK_IMPORTED_MODULE_0__[\"unselect\"](s);\r\n    else if (!s.selectable.enabled)\r\n        _board__WEBPACK_IMPORTED_MODULE_0__[\"unselect\"](s);\r\n    removeDragElements(s);\r\n    s.draggable.current = undefined;\r\n    s.dom.redraw();\r\n}\r\nfunction pieceCloseTo(s, pos) {\r\n    var asWhite = _board__WEBPACK_IMPORTED_MODULE_0__[\"whitePov\"](s), bounds = s.dom.bounds(), radiusSq = Math.pow(bounds.width / 9, 2);\r\n    for (var key in s.pieces) {\r\n        var squareBounds = computeSquareBounds(key, asWhite, bounds), center = [\r\n            squareBounds.left + squareBounds.width / 2,\r\n            squareBounds.top + squareBounds.height / 2\r\n        ];\r\n        if (_util__WEBPACK_IMPORTED_MODULE_1__[\"distanceSq\"](center, pos) <= radiusSq)\r\n            return true;\r\n    }\r\n    return false;\r\n}\r\nfunction processDrag(s) {\r\n    requestAnimationFrame(function () {\r\n        var cur = s.draggable.current;\r\n        if (!cur)\r\n            return;\r\n        // cancel animations while dragging\r\n        if (s.animation.current && s.animation.current.plan.anims[cur.orig])\r\n            s.animation.current = undefined;\r\n        // if moving piece is gone, cancel\r\n        var origPiece = s.pieces[cur.orig];\r\n        if (!origPiece || !_util__WEBPACK_IMPORTED_MODULE_1__[\"samePiece\"](origPiece, cur.piece))\r\n            cancel(s);\r\n        else {\r\n            if (!cur.started && _util__WEBPACK_IMPORTED_MODULE_1__[\"distanceSq\"](cur.epos, cur.rel) >= Math.pow(s.draggable.distance, 2))\r\n                cur.started = true;\r\n            if (cur.started) {\r\n                // support lazy elements\r\n                if (typeof cur.element === 'function') {\r\n                    var found = cur.element();\r\n                    if (!found)\r\n                        return;\r\n                    found.cgDragging = true;\r\n                    found.classList.add('dragging');\r\n                    cur.element = found;\r\n                }\r\n                cur.pos = [\r\n                    cur.epos[0] - cur.rel[0],\r\n                    cur.epos[1] - cur.rel[1]\r\n                ];\r\n                // move piece\r\n                var translation = _util__WEBPACK_IMPORTED_MODULE_1__[\"posToTranslateAbs\"](s.dom.bounds())(cur.origPos, _board__WEBPACK_IMPORTED_MODULE_0__[\"whitePov\"](s));\r\n                translation[0] += cur.pos[0] + cur.dec[0];\r\n                translation[1] += cur.pos[1] + cur.dec[1];\r\n                _util__WEBPACK_IMPORTED_MODULE_1__[\"translateAbs\"](cur.element, translation);\r\n            }\r\n        }\r\n        processDrag(s);\r\n    });\r\n}\r\nfunction computeSquareBounds(key, asWhite, bounds) {\r\n    var pos = _util__WEBPACK_IMPORTED_MODULE_1__[\"key2pos\"](key);\r\n    if (!asWhite) {\r\n        pos[0] = (_types__WEBPACK_IMPORTED_MODULE_2__[\"size\"] + 1) - pos[0];\r\n        pos[1] = (_types__WEBPACK_IMPORTED_MODULE_2__[\"size\"] + 1) - pos[1];\r\n    }\r\n    return {\r\n        left: bounds.left + bounds.width * (pos[0] - 1) / _types__WEBPACK_IMPORTED_MODULE_2__[\"size\"],\r\n        top: bounds.top + bounds.height * (_types__WEBPACK_IMPORTED_MODULE_2__[\"size\"] - pos[1]) / _types__WEBPACK_IMPORTED_MODULE_2__[\"size\"],\r\n        width: bounds.width / _types__WEBPACK_IMPORTED_MODULE_2__[\"size\"],\r\n        height: bounds.height / _types__WEBPACK_IMPORTED_MODULE_2__[\"size\"]\r\n    };\r\n}\r\nfunction cancel(s) {\r\n    var cur = s.draggable.current;\r\n    if (cur) {\r\n        if (cur.newPiece)\r\n            delete s.pieces[cur.orig];\r\n        s.draggable.current = undefined;\r\n        _board__WEBPACK_IMPORTED_MODULE_0__[\"unselect\"](s);\r\n        removeDragElements(s);\r\n        s.dom.redraw();\r\n    }\r\n}\r\nfunction removeDragElements(s) {\r\n    var e = s.dom.elements;\r\n    if (e.ghost)\r\n        _util__WEBPACK_IMPORTED_MODULE_1__[\"setVisible\"](e.ghost, false);\r\n}\r\nfunction pieceElementByKey(s, key) {\r\n    var el = s.dom.elements.board.firstChild;\r\n    while (el) {\r\n        if (el.cgKey === key && el.tagName === 'PIECE')\r\n            return el;\r\n        el = el.nextSibling;\r\n    }\r\n    return undefined;\r\n}\r\n\n\n//# sourceURL=webpack:///./src/drag.ts?");

/***/ }),

/***/ "./src/draw.ts":
/*!*********************!*\
  !*** ./src/draw.ts ***!
  \*********************/
/*! exports provided: clear, start, processDraw, cancel, move, end */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"clear\", function() { return clear; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"start\", function() { return start; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"processDraw\", function() { return processDraw; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"cancel\", function() { return cancel; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"move\", function() { return move; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"end\", function() { return end; });\n/* harmony import */ var _board__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./board */ \"./src/board.ts\");\n/* harmony import */ var _util__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./util */ \"./src/util.ts\");\n\r\n\r\nvar brushes = ['green', 'red', 'blue', 'yellow'];\r\nfunction clear(state) {\r\n    if (state.drawable.shapes.length) {\r\n        state.drawable.shapes = [];\r\n        state.dom.redraw();\r\n        onChange(state.drawable);\r\n    }\r\n}\r\nfunction start(state, e) {\r\n    if (e.touches && e.touches.length > 1)\r\n        return; // support one finger touch only\r\n    e.stopPropagation();\r\n    e.preventDefault();\r\n    e.ctrlKey ? Object(_board__WEBPACK_IMPORTED_MODULE_0__[\"unselect\"])(state) : Object(_board__WEBPACK_IMPORTED_MODULE_0__[\"cancelMove\"])(state);\r\n    var pos = Object(_util__WEBPACK_IMPORTED_MODULE_1__[\"eventPosition\"])(e), orig = Object(_board__WEBPACK_IMPORTED_MODULE_0__[\"getKeyAtDomPos\"])(pos, Object(_board__WEBPACK_IMPORTED_MODULE_0__[\"whitePov\"])(state), state.dom.bounds());\r\n    if (!orig)\r\n        return;\r\n    state.drawable.current = {\r\n        orig: orig,\r\n        pos: pos,\r\n        brush: eventBrush(e)\r\n    };\r\n    processDraw(state);\r\n}\r\nfunction processDraw(state) {\r\n    requestAnimationFrame(function () {\r\n        var cur = state.drawable.current;\r\n        if (cur) {\r\n            var mouseSq = Object(_board__WEBPACK_IMPORTED_MODULE_0__[\"getKeyAtDomPos\"])(cur.pos, Object(_board__WEBPACK_IMPORTED_MODULE_0__[\"whitePov\"])(state), state.dom.bounds());\r\n            if (mouseSq !== cur.mouseSq) {\r\n                cur.mouseSq = mouseSq;\r\n                cur.dest = mouseSq !== cur.orig ? mouseSq : undefined;\r\n                state.dom.redrawNow();\r\n            }\r\n            processDraw(state);\r\n        }\r\n    });\r\n}\r\nfunction cancel(state) {\r\n    if (state.drawable.current) {\r\n        state.drawable.current = undefined;\r\n        state.dom.redraw();\r\n    }\r\n}\r\nfunction move(state, e) {\r\n    if (state.drawable.current)\r\n        state.drawable.current.pos = Object(_util__WEBPACK_IMPORTED_MODULE_1__[\"eventPosition\"])(e);\r\n}\r\nfunction eventBrush(e) {\r\n    return brushes[((e.shiftKey || e.ctrlKey) && Object(_util__WEBPACK_IMPORTED_MODULE_1__[\"isRightButton\"])(e) ? 1 : 0) + (e.altKey ? 2 : 0)];\r\n}\r\nfunction end(state) {\r\n    var cur = state.drawable.current;\r\n    if (cur) {\r\n        if (cur.mouseSq)\r\n            addShape(state.drawable, cur);\r\n        cancel(state);\r\n    }\r\n}\r\nfunction onChange(drawable) {\r\n    if (drawable.onChange)\r\n        drawable.onChange(drawable.shapes);\r\n}\r\nfunction addShape(drawable, cur) {\r\n    var sameShape = function (s) { return s.orig === cur.orig && s.dest === cur.dest; };\r\n    var similar = drawable.shapes.filter(sameShape)[0];\r\n    if (similar)\r\n        drawable.shapes = drawable.shapes.filter(function (s) { return !sameShape(s); });\r\n    if (!similar || similar.brush !== cur.brush)\r\n        drawable.shapes.push(cur);\r\n    onChange(drawable);\r\n}\r\n\n\n//# sourceURL=webpack:///./src/draw.ts?");

/***/ }),

/***/ "./src/drop.ts":
/*!*********************!*\
  !*** ./src/drop.ts ***!
  \*********************/
/*! exports provided: drop */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"drop\", function() { return drop; });\n/* harmony import */ var _util__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./util */ \"./src/util.ts\");\n\r\n//new pieceを配置する？\r\nfunction drop(s, e) {\r\n    if (!s.dropmode.active)\r\n        return;\r\n    // premove \r\n    //board.unsetPremove(s);\r\n    //board.unsetPredrop(s);\r\n    var piece = s.dropmode.piece;\r\n    if (piece) {\r\n        s.pieces.a0 = piece;\r\n        var position = _util__WEBPACK_IMPORTED_MODULE_0__[\"eventPosition\"](e);\r\n        /*\r\n        const dest = position && board.getKeyAtDomPos(\r\n          position, board.whitePov(s), s.dom.bounds());\r\n        if (dest) board.dropNewPiece(s, 'a0', dest);\r\n        */\r\n    }\r\n    s.dom.redraw();\r\n}\r\n\n\n//# sourceURL=webpack:///./src/drop.ts?");

/***/ }),

/***/ "./src/events.ts":
/*!***********************!*\
  !*** ./src/events.ts ***!
  \***********************/
/*! exports provided: bindBoard, bindDocument */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"bindBoard\", function() { return bindBoard; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"bindDocument\", function() { return bindDocument; });\n/* harmony import */ var _drag__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./drag */ \"./src/drag.ts\");\n/* harmony import */ var _draw__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./draw */ \"./src/draw.ts\");\n/* harmony import */ var _drop__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./drop */ \"./src/drop.ts\");\n/* harmony import */ var _util__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./util */ \"./src/util.ts\");\n\r\n\r\n\r\n\r\n//盤オブジェクトにイベントをバインドさせる。\r\nfunction bindBoard(s) {\r\n    if (s.viewOnly)\r\n        return;\r\n    var boardEl = s.dom.elements.board, onStart = startDragOrDraw(s);\r\n    // Cannot be passive, because we prevent touch scrolling and dragging of\r\n    // selected elements.\r\n    boardEl.addEventListener('touchstart', onStart, { passive: false });\r\n    boardEl.addEventListener('mousedown', onStart, { passive: false });\r\n    //if (s.disableContextMenu || s.drawable.enabled) {\r\n    boardEl.addEventListener('contextmenu', function (e) { return e.preventDefault(); });\r\n    //}\r\n}\r\n// returns the unbind function\r\n//バインド解除関数を返す\r\nfunction bindDocument(s, redrawAll) {\r\n    var unbinds = [];\r\n    if (!s.dom.relative && s.resizable) {\r\n        var onResize = function () {\r\n            s.dom.bounds.clear();\r\n            requestAnimationFrame(redrawAll);\r\n        };\r\n        unbinds.push(unbindable(document.body, 'chessground.resize', onResize));\r\n    }\r\n    if (!s.viewOnly) {\r\n        var onmove_1 = dragOrDraw(s, _drag__WEBPACK_IMPORTED_MODULE_0__[\"move\"], _draw__WEBPACK_IMPORTED_MODULE_1__[\"move\"]);\r\n        var onend_1 = dragOrDraw(s, _drag__WEBPACK_IMPORTED_MODULE_0__[\"end\"], _draw__WEBPACK_IMPORTED_MODULE_1__[\"end\"]);\r\n        ['touchmove', 'mousemove'].forEach(function (ev) { return unbinds.push(unbindable(document, ev, onmove_1)); });\r\n        ['touchend', 'mouseup'].forEach(function (ev) { return unbinds.push(unbindable(document, ev, onend_1)); });\r\n        var onScroll = function () { return s.dom.bounds.clear(); };\r\n        unbinds.push(unbindable(window, 'scroll', onScroll, { passive: true }));\r\n        unbinds.push(unbindable(window, 'resize', onScroll, { passive: true }));\r\n    }\r\n    return function () { return unbinds.forEach(function (f) { return f(); }); };\r\n}\r\nfunction unbindable(el, eventName, callback, options) {\r\n    el.addEventListener(eventName, callback, options);\r\n    return function () { return el.removeEventListener(eventName, callback); };\r\n}\r\nfunction startDragOrDraw(s) {\r\n    return function (e) {\r\n        if (s.draggable.current)\r\n            _drag__WEBPACK_IMPORTED_MODULE_0__[\"cancel\"](s);\r\n        else if (s.drawable.current)\r\n            _draw__WEBPACK_IMPORTED_MODULE_1__[\"cancel\"](s);\r\n        else if (e.shiftKey || Object(_util__WEBPACK_IMPORTED_MODULE_3__[\"isRightButton\"])(e)) {\r\n            if (s.drawable.enabled)\r\n                _draw__WEBPACK_IMPORTED_MODULE_1__[\"start\"](s, e);\r\n        }\r\n        else {\r\n            if (s.dropmode.active)\r\n                Object(_drop__WEBPACK_IMPORTED_MODULE_2__[\"drop\"])(s, e);\r\n            else\r\n                _drag__WEBPACK_IMPORTED_MODULE_0__[\"start\"](s, e);\r\n        }\r\n    };\r\n}\r\nfunction dragOrDraw(s, withDrag, withDraw) {\r\n    return function (e) {\r\n        if (e.shiftKey || Object(_util__WEBPACK_IMPORTED_MODULE_3__[\"isRightButton\"])(e)) {\r\n            if (s.drawable.enabled)\r\n                withDraw(s, e);\r\n        }\r\n        else if (!s.viewOnly)\r\n            withDrag(s, e);\r\n    };\r\n}\r\n\n\n//# sourceURL=webpack:///./src/events.ts?");

/***/ }),

/***/ "./src/fen.ts":
/*!********************!*\
  !*** ./src/fen.ts ***!
  \********************/
/*! exports provided: initial, chushogi_read, read, write */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"initial\", function() { return initial; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"chushogi_read\", function() { return chushogi_read; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"read\", function() { return read; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"write\", function() { return write; });\n/* harmony import */ var _util__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./util */ \"./src/util.ts\");\n/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./types */ \"./src/types.ts\");\n\r\n\r\nvar initial = 'rrnbbqkbbnrr/pppppppppppp/0/0/0/0/0/PPPPPPPPPPPP/RRNBBQKBBNRR';\r\n//export const initial: cg.FEN = 'rnbqkbnrr/ppppppppp/9/9/9/9/9/PPPPPPPPP/RNBQKBNRR';\r\n//export const initial: cg.FEN = 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR';\r\n///export const initial : cg.FEN = '8/6R1/1k1r2p1/1P3p1p/N1Pnp3/2K3P1/3p1P2/8 b - - 2 47';\r\n//const roles: { [letter: string]: cg.Role } = { p: 'pawn', r: 'rook', n: 'knight', b: 'bishop', q: 'queen', k: 'king' };\r\nvar letters = { pawn: 'p', rook: 'r', knight: 'n', bishop: 'b', queen: 'q', king: 'k' };\r\nfunction chushogi_read() {\r\n    var pieces = {};\r\n    var role = 'black';\r\n    //////// 1st row ////////\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([1, 1])] = {\r\n        role: '12',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([2, 1])] = {\r\n        role: '6',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([3, 1])] = {\r\n        role: '4',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([4, 1])] = {\r\n        role: '5',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([5, 1])] = {\r\n        role: '7',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([6, 1])] = {\r\n        role: '1',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([7, 1])] = {\r\n        role: '9',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([8, 1])] = {\r\n        role: '7',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([9, 1])] = {\r\n        role: '5',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([10, 1])] = {\r\n        role: '4',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([11, 1])] = {\r\n        role: '6',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([12, 1])] = {\r\n        role: '12',\r\n        color: 'white'\r\n    };\r\n    //////// 2nd row ////////\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([1, 2])] = {\r\n        role: '13',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([3, 2])] = {\r\n        role: '16',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([5, 2])] = {\r\n        role: '8',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([6, 2])] = {\r\n        role: '10',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([7, 2])] = {\r\n        role: '11',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([8, 2])] = {\r\n        role: '8',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([10, 2])] = {\r\n        role: '16',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([12, 2])] = {\r\n        role: '13',\r\n        color: 'white'\r\n    };\r\n    //////// 3rd row ////////\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([1, 3])] = {\r\n        role: '14',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([2, 3])] = {\r\n        role: '15',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([3, 3])] = {\r\n        role: '17',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([4, 3])] = {\r\n        role: '18',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([5, 3])] = {\r\n        role: '19',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([6, 3])] = {\r\n        role: '21',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([7, 3])] = {\r\n        role: '20',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([8, 3])] = {\r\n        role: '19',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([9, 3])] = {\r\n        role: '18',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([10, 3])] = {\r\n        role: '17',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([11, 3])] = {\r\n        role: '15',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([12, 3])] = {\r\n        role: '14',\r\n        color: 'white'\r\n    };\r\n    //////// 4th row ////////\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([1, 4])] = {\r\n        role: '2',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([2, 4])] = {\r\n        role: '2',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([3, 4])] = {\r\n        role: '2',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([4, 4])] = {\r\n        role: '2',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([5, 4])] = {\r\n        role: '2',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([6, 4])] = {\r\n        role: '2',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([7, 4])] = {\r\n        role: '2',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([8, 4])] = {\r\n        role: '2',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([9, 4])] = {\r\n        role: '2',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([10, 4])] = {\r\n        role: '2',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([11, 4])] = {\r\n        role: '2',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([12, 4])] = {\r\n        role: '2',\r\n        color: 'white'\r\n    };\r\n    //////// 5th row ////////\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([4, 5])] = {\r\n        role: '3',\r\n        color: 'white'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([9, 5])] = {\r\n        role: '3',\r\n        color: 'white'\r\n    };\r\n    //////// 1st row ////////\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([1, 12])] = {\r\n        role: '12',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([2, 12])] = {\r\n        role: '6',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([3, 12])] = {\r\n        role: '4',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([4, 12])] = {\r\n        role: '5',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([5, 12])] = {\r\n        role: '7',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([6, 12])] = {\r\n        role: '1',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([7, 12])] = {\r\n        role: '9',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([8, 12])] = {\r\n        role: '7',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([9, 12])] = {\r\n        role: '5',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([10, 12])] = {\r\n        role: '4',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([11, 12])] = {\r\n        role: '6',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([12, 12])] = {\r\n        role: '12',\r\n        color: 'black'\r\n    };\r\n    //////// 2nd row ////////\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([1, 11])] = {\r\n        role: '13',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([3, 11])] = {\r\n        role: '16',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([5, 11])] = {\r\n        role: '8',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([6, 11])] = {\r\n        role: '10',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([7, 11])] = {\r\n        role: '11',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([8, 11])] = {\r\n        role: '8',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([10, 11])] = {\r\n        role: '16',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([12, 11])] = {\r\n        role: '13',\r\n        color: 'black'\r\n    };\r\n    //////// 3rd row ////////\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([1, 10])] = {\r\n        role: '14',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([2, 10])] = {\r\n        role: '15',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([3, 10])] = {\r\n        role: '17',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([4, 10])] = {\r\n        role: '18',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([5, 10])] = {\r\n        role: '19',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([6, 10])] = {\r\n        role: '21',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([7, 10])] = {\r\n        role: '20',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([8, 10])] = {\r\n        role: '19',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([9, 10])] = {\r\n        role: '18',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([10, 10])] = {\r\n        role: '17',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([11, 10])] = {\r\n        role: '15',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([12, 10])] = {\r\n        role: '14',\r\n        color: 'black'\r\n    };\r\n    //////// 4th row ////////\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([1, 9])] = {\r\n        role: '2',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([2, 9])] = {\r\n        role: '2',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([3, 9])] = {\r\n        role: '2',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([4, 9])] = {\r\n        role: '2',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([5, 9])] = {\r\n        role: '2',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([6, 9])] = {\r\n        role: '2',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([7, 9])] = {\r\n        role: '2',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([8, 9])] = {\r\n        role: '2',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([9, 9])] = {\r\n        role: '2',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([10, 9])] = {\r\n        role: '2',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([11, 9])] = {\r\n        role: '2',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([12, 9])] = {\r\n        role: '2',\r\n        color: 'black'\r\n    };\r\n    //////// 5th row ////////\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([4, 8])] = {\r\n        role: '3',\r\n        color: 'black'\r\n    };\r\n    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([9, 8])] = {\r\n        role: '3',\r\n        color: 'black'\r\n    };\r\n    /*\r\n    pieces[pos2key([col, row])] = {\r\n      role: roles[role],\r\n      color: (c === role ? 'black' : 'white') as cg.Color\r\n    };\r\n    */\r\n    return pieces;\r\n}\r\nfunction read(fen) {\r\n    if (fen === 'start')\r\n        fen = initial;\r\n    var pieces = {};\r\n    var row = _types__WEBPACK_IMPORTED_MODULE_1__[\"size\"], col = 0;\r\n    for (var _i = 0, fen_1 = fen; _i < fen_1.length; _i++) {\r\n        var c = fen_1[_i];\r\n        switch (c) {\r\n            case ' ': return pieces;\r\n            case '/':\r\n                --row;\r\n                if (row === 0)\r\n                    return pieces;\r\n                col = 0;\r\n                break;\r\n            case '~':\r\n                var piece = pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([col, row])];\r\n                if (piece)\r\n                    piece.promoted = true;\r\n                break;\r\n            default:\r\n                var nb = c.charCodeAt(0);\r\n                if (nb < 58)\r\n                    col += nb - 48;\r\n                else {\r\n                    ++col;\r\n                    var role = c.toLowerCase();\r\n                    pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([col, row])] = {\r\n                        role: \"1\",\r\n                        color: (c === role ? 'black' : 'white')\r\n                    };\r\n                }\r\n        }\r\n    }\r\n    return pieces;\r\n}\r\nfunction write(pieces) {\r\n    return _util__WEBPACK_IMPORTED_MODULE_0__[\"invRanks\"].map(function (y) { return _types__WEBPACK_IMPORTED_MODULE_1__[\"ranks\"].map(function (x) {\r\n        var piece = pieces[Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"])([x, y])];\r\n        if (piece) {\r\n            var letter = letters[piece.role];\r\n            return piece.color === 'white' ? letter.toUpperCase() : letter;\r\n        }\r\n        else\r\n            return '1';\r\n    }).join(''); }).join('/').replace(/1{2,}/g, function (s) { return s.length.toString(); });\r\n}\r\n\n\n//# sourceURL=webpack:///./src/fen.ts?");

/***/ }),

/***/ "./src/index.ts":
/*!**********************!*\
  !*** ./src/index.ts ***!
  \**********************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _chessground__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./chessground */ \"./src/chessground.ts\");\n\r\nvar config = {\r\n    movable: {\r\n        free: false,\r\n    }\r\n};\r\nObject(_chessground__WEBPACK_IMPORTED_MODULE_0__[\"Chessground\"])(document.getElementById(\"app\"), config);\r\n\n\n//# sourceURL=webpack:///./src/index.ts?");

/***/ }),

/***/ "./src/move.ts":
/*!*********************!*\
  !*** ./src/move.ts ***!
  \*********************/
/*! exports provided: legalMove */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"legalMove\", function() { return legalMove; });\n/* harmony import */ var _util__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./util */ \"./src/util.ts\");\n/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./types */ \"./src/types.ts\");\n\r\n\r\nvar allPos = _util__WEBPACK_IMPORTED_MODULE_0__[\"allKeys\"].map(_util__WEBPACK_IMPORTED_MODULE_0__[\"key2pos\"]);\r\nfunction diff(a, b) {\r\n    return Math.abs(a - b);\r\n}\r\n/**\r\n * 駒ごとの動きを設定します。\r\n * dxとdyは必ず同じ要素数でなければなりません。\r\n  \"1\" : {\r\n    key: 1, // 駒ID\r\n    name: \"玉\", // 駒名\r\n    point: 1.0, // 駒の得点\r\n    is_promoted: null, //true: 成り駒、false: 未成り駒、null: 成らず駒\r\n    step: [ // 歩く場合の行先\r\n      [-1, -1, -1, 0, 0, 1, 1, 1], //dx (横の変化量) ※dxとdyは必ず同じ要素数\r\n      [-1, 0, 1, -1, 1, -1, 0, 1]  //dy (縦の変化量)\r\n    ],\r\n    run: [ //走り方向\r\n    ]\r\n  },\r\n*/\r\nvar CHUSHOGI_PIECES = {\r\n    \"0\": {\r\n        key: 0,\r\n        name: \"　\",\r\n        point: 0,\r\n        is_promoted: null,\r\n        step: [],\r\n        run: []\r\n    },\r\n    \"1\": {\r\n        key: 1,\r\n        name: \"玉\",\r\n        point: 0,\r\n        is_promoted: null,\r\n        step: [\r\n            [-1, -1, -1, 0, 0, 1, 1, 1],\r\n            [-1, 0, 1, -1, 1, -1, 0, 1]\r\n        ],\r\n        run: []\r\n    },\r\n    \"2\": {\r\n        key: 2,\r\n        name: \"歩\",\r\n        point: 1.0,\r\n        is_promoted: false,\r\n        step: [\r\n            [0],\r\n            [1]\r\n        ],\r\n        run: []\r\n    },\r\n    \"3\": {\r\n        key: 3,\r\n        name: \"仲\",\r\n        point: 1.6,\r\n        is_promoted: false,\r\n        step: [\r\n            [0, 0],\r\n            [-1, 1]\r\n        ],\r\n        run: []\r\n    },\r\n    \"4\": {\r\n        key: 4,\r\n        name: \"銅\",\r\n        point: 3.0,\r\n        is_promoted: false,\r\n        step: [\r\n            [0, 0, -1, 1],\r\n            [-1, 1, 1, 1]\r\n        ],\r\n        run: []\r\n    },\r\n    \"5\": {\r\n        key: 5,\r\n        name: \"銀\",\r\n        point: 3.4,\r\n        is_promoted: false,\r\n        step: [\r\n            [-1, 1, 0, -1, 1],\r\n            [-1, -1, 1, 1, 1]\r\n        ],\r\n        run: []\r\n    },\r\n    \"6\": {\r\n        key: 6,\r\n        name: \"豹\",\r\n        point: 4.0,\r\n        is_promoted: false,\r\n        step: [\r\n            [-1, 1, 0, 0, -1, 1],\r\n            [-1, -1, 1, -1, 1, 1]\r\n        ],\r\n        run: []\r\n    },\r\n    \"7\": {\r\n        key: 7,\r\n        name: \"金\",\r\n        point: 4.4,\r\n        is_promoted: false,\r\n        step: [\r\n            [-1, -1, 0, 0, 1, 1],\r\n            [1, 0, 1, -1, 1, 0]\r\n        ],\r\n        run: []\r\n    },\r\n    \"8\": {\r\n        key: 8,\r\n        name: \"盲\",\r\n        point: 4.7,\r\n        is_promoted: false,\r\n        step: [\r\n            [-1, -1, -1, 0, 1, 1, 1],\r\n            [-1, 0, 1, -1, -1, 0, 1]\r\n        ],\r\n        run: []\r\n    },\r\n    \"9\": {\r\n        key: 9,\r\n        name: \"酔\",\r\n        point: 5.9,\r\n        is_promoted: false,\r\n        step: [\r\n            [-1, -1, -1, 0, 1, 1, 1],\r\n            [-1, 0, 1, 1, -1, 0, 1]\r\n        ],\r\n        run: []\r\n    },\r\n    \"10\": {\r\n        key: 10,\r\n        name: \"麒\",\r\n        point: 6.4,\r\n        is_promoted: false,\r\n        step: [\r\n            [-1, 1, -1, 1, 0, 0, -2, 2],\r\n            [-1, -1, 1, 1, -2, 2, 0, 0],\r\n        ],\r\n        run: []\r\n    },\r\n    \"11\": {\r\n        key: 11,\r\n        name: \"鳳\",\r\n        point: 5.7,\r\n        is_promoted: false,\r\n        step: [\r\n            [0, 0, -1, 1, -2, -2, 2, 2],\r\n            [-1, 1, 0, 0, -2, 2, -2, 2],\r\n        ],\r\n        run: []\r\n    },\r\n    \"12\": {\r\n        key: 12,\r\n        name: \"香\",\r\n        point: 3.5,\r\n        is_promoted: false,\r\n        step: [],\r\n        run: [\r\n            [0],\r\n            [1],\r\n        ]\r\n    },\r\n    \"13\": {\r\n        key: 13,\r\n        name: \"反\",\r\n        point: 4.9,\r\n        is_promoted: false,\r\n        step: [],\r\n        run: [\r\n            [0, 0],\r\n            [1, -1],\r\n        ]\r\n    },\r\n    \"14\": {\r\n        key: 14,\r\n        name: \"横\",\r\n        point: 6.4,\r\n        is_promoted: false,\r\n        step: [\r\n            [0, 0],\r\n            [-1, 1]\r\n        ],\r\n        run: [\r\n            [-1, 1],\r\n            [0, 0],\r\n        ]\r\n    },\r\n    \"15\": {\r\n        key: 15,\r\n        name: \"竪\",\r\n        point: 6.4,\r\n        is_promoted: false,\r\n        step: [\r\n            [-1, 1],\r\n            [0, 0]\r\n        ],\r\n        run: [\r\n            [0, 0],\r\n            [1, -1],\r\n        ]\r\n    },\r\n    \"16\": {\r\n        key: 16,\r\n        name: \"角\",\r\n        point: 6.7,\r\n        is_promoted: false,\r\n        step: [],\r\n        run: [\r\n            [-1, -1, 1, 1],\r\n            [-1, 1, -1, 1],\r\n        ]\r\n    },\r\n    \"17\": {\r\n        key: 17,\r\n        name: \"飛\",\r\n        point: 9.5,\r\n        is_promoted: false,\r\n        step: [],\r\n        run: [\r\n            [0, 0, -1, 1],\r\n            [-1, 1, 0, 0],\r\n        ]\r\n    },\r\n    \"18\": {\r\n        key: 18,\r\n        name: \"馬\",\r\n        point: 9.7,\r\n        is_promoted: false,\r\n        step: [\r\n            [0, 0, -1, 1],\r\n            [-1, 1, 0, 0],\r\n        ],\r\n        run: [\r\n            [-1, -1, 1, 1],\r\n            [-1, 1, -1, 1],\r\n        ]\r\n    },\r\n    \"19\": {\r\n        key: 19,\r\n        name: \"龍\",\r\n        point: 12.1,\r\n        is_promoted: false,\r\n        step: [\r\n            [0, 0, -1, 1],\r\n            [-1, 1, 0, 0],\r\n        ],\r\n        run: [\r\n            [0, 0, -1, 1],\r\n            [-1, 1, 0, 0],\r\n        ]\r\n    },\r\n    \"20\": {\r\n        key: 20,\r\n        name: \"奔\",\r\n        point: 14.1,\r\n        is_promoted: null,\r\n        step: [],\r\n        run: [\r\n            [-1, -1, -1, 0, 0, 1, 1, 1],\r\n            [-1, 0, 1, -1, 1, -1, 0, 1]\r\n        ]\r\n    },\r\n    \"21\": {\r\n        key: 21,\r\n        name: \"獅\",\r\n        point: 19.1,\r\n        is_promoted: null,\r\n        step: [\r\n            [-1, -1, -1, -1, -1, 0, 0, 0, 0, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, -2, -2, -2, -2, -2],\r\n            [-2, -1, 0, 1, 2, -2, -1, 1, 2, -2, -1, 0, 1, 2, -2, -1, 0, 1, 2, -2, -1, 0, 1, 2]\r\n        ],\r\n        run: []\r\n    },\r\n    \"102\": {\r\n        key: 102,\r\n        name: \"と\",\r\n        point: 3.5,\r\n        is_promoted: true,\r\n        step: [\r\n            [-1, -1, 0, 0, 1, 1],\r\n            [1, 0, 1, -1, 1, 0]\r\n        ],\r\n        run: []\r\n    },\r\n    \"103\": {\r\n        key: 103,\r\n        name: \"象\",\r\n        point: 4.0,\r\n        is_promoted: true,\r\n        step: [\r\n            [-1, -1, -1, 0, 1, 1, 1],\r\n            [-1, 0, 1, 1, -1, 0, 1]\r\n        ],\r\n        run: []\r\n    },\r\n    \"104\": {\r\n        key: 104,\r\n        name: \"横\",\r\n        point: 5.4,\r\n        is_promoted: true,\r\n        step: [\r\n            [0, 0],\r\n            [-1, 1]\r\n        ],\r\n        run: [\r\n            [-1, 1],\r\n            [0, 0],\r\n        ]\r\n    },\r\n    \"105\": {\r\n        key: 15,\r\n        name: \"竪\",\r\n        point: 5.4,\r\n        is_promoted: true,\r\n        step: [\r\n            [-1, 1],\r\n            [0, 0]\r\n        ],\r\n        run: [\r\n            [0, 0],\r\n            [1, -1],\r\n        ]\r\n    },\r\n    \"106\": {\r\n        key: 106,\r\n        name: \"角\",\r\n        point: 5.7,\r\n        is_promoted: true,\r\n        step: [],\r\n        run: [\r\n            [-1, -1, 1, 1],\r\n            [-1, 1, -1, 1],\r\n        ]\r\n    },\r\n    \"107\": {\r\n        key: 107,\r\n        name: \"飛\",\r\n        point: 8.4,\r\n        is_promoted: true,\r\n        step: [],\r\n        run: [\r\n            [0, 0, -1, 1],\r\n            [-1, 1, 0, 0],\r\n        ]\r\n    },\r\n    \"108\": {\r\n        key: 108,\r\n        name: \"鹿\",\r\n        point: 7.6,\r\n        is_promoted: false,\r\n        step: [\r\n            [-1, -1, -1, 1, 1, 1],\r\n            [-1, 0, 1, -1, 0, 1]\r\n        ],\r\n        run: [\r\n            [0, 0],\r\n            [1, -1],\r\n        ]\r\n    },\r\n    \"109\": {\r\n        key: 109,\r\n        name: \"太\",\r\n        point: 17.6,\r\n        is_promoted: true,\r\n        step: [\r\n            [-1, -1, -1, 0, 0, 1, 1, 1],\r\n            [-1, 0, 1, -1, 1, -1, 0, 1]\r\n        ],\r\n        run: []\r\n    },\r\n    \"110\": {\r\n        key: 110,\r\n        name: \"獅\",\r\n        point: 19.1,\r\n        is_promoted: true,\r\n        step: [\r\n            [-1, -1, -1, -1, -1, 0, 0, 0, 0, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, -2, -2, -2, -2, -2],\r\n            [-2, -1, 0, 1, 2, -2, -1, 1, 2, -2, -1, 0, 1, 2, -2, -1, 0, 1, 2, -2, -1, 0, 1, 2]\r\n        ],\r\n        run: []\r\n    },\r\n    \"111\": {\r\n        key: 111,\r\n        name: \"奔\",\r\n        point: 14.1,\r\n        is_promoted: true,\r\n        step: [],\r\n        run: [\r\n            [-1, -1, -1, 0, 0, 1, 1, 1],\r\n            [-1, 0, 1, -1, 1, -1, 0, 1]\r\n        ]\r\n    },\r\n    \"112\": {\r\n        key: 112,\r\n        name: \"白\",\r\n        point: 7.0,\r\n        is_promoted: true,\r\n        step: [],\r\n        run: [\r\n            [0, 0, -1, 1],\r\n            [1, -1, 1, 1],\r\n        ]\r\n    },\r\n    \"113\": {\r\n        key: 113,\r\n        name: \"鯨\",\r\n        point: 7.0,\r\n        is_promoted: true,\r\n        step: [],\r\n        run: [\r\n            [0, 0, -1, 1],\r\n            [1, -1, -1, -1],\r\n        ]\r\n    },\r\n    \"114\": {\r\n        key: 114,\r\n        name: \"猪\",\r\n        point: 9.9,\r\n        is_promoted: true,\r\n        step: [],\r\n        run: [\r\n            [-1, -1, -1, 1, 1, 1],\r\n            [-1, 0, 1, -1, 0, 1],\r\n        ]\r\n    },\r\n    \"115\": {\r\n        key: 115,\r\n        name: \"牛\",\r\n        point: 9.9,\r\n        is_promoted: true,\r\n        step: [],\r\n        run: [\r\n            [-1, 0, -1, 1, 0, 1],\r\n            [-1, -1, 1, -1, 1, 1],\r\n        ]\r\n    },\r\n    \"116\": {\r\n        key: 116,\r\n        name: \"馬\",\r\n        point: 8.1,\r\n        is_promoted: true,\r\n        step: [\r\n            [0, 0, -1, 1],\r\n            [-1, 1, 0, 0],\r\n        ],\r\n        run: [\r\n            [-1, -1, 1, 1],\r\n            [-1, 1, -1, 1],\r\n        ]\r\n    },\r\n    \"117\": {\r\n        key: 117,\r\n        name: \"龍\",\r\n        point: 10.6,\r\n        is_promoted: true,\r\n        step: [\r\n            [0, 0, -1, 1],\r\n            [-1, 1, 0, 0],\r\n        ],\r\n        run: [\r\n            [0, 0, -1, 1],\r\n            [-1, 1, 0, 0],\r\n        ]\r\n    },\r\n    \"118\": {\r\n        key: 118,\r\n        name: \"鷹\",\r\n        point: 14.0,\r\n        is_promoted: true,\r\n        step: [],\r\n        run: [\r\n            [-1, -1, 0, -1, 1, 1, 1],\r\n            [-1, 0, -1, 1, -1, 0, 1],\r\n        ]\r\n    },\r\n    \"119\": {\r\n        key: 119,\r\n        name: \"鷲\",\r\n        point: 14.8,\r\n        is_promoted: true,\r\n        step: [],\r\n        run: [\r\n            [-1, -1, 0, 1, 1, 0],\r\n            [-1, 0, -1, -1, 0, 1],\r\n        ]\r\n    },\r\n};\r\n/**\r\n * 2回移動を行う場合の駒の動きを規定します。\r\n * 獅子の動きは単純に2回行動(second_move_type: 1)なのに対し、飛鷲と角鷹は同じ方向に2歩分進む動きとなり、\r\n * 1回目の動きによって進めるマスが変化する。(second_move_type: 2)\r\n*/\r\nvar CHUSHOGI_SECOND_MOVES = {\r\n    \"21\": {\r\n        second_move_type: 1,\r\n        step: [\r\n            [-1, -1, -1, 0, 0, 1, 1, 1],\r\n            [-1, 0, 1, -1, 1, -1, 0, 1]\r\n        ],\r\n    },\r\n    \"110\": {\r\n        second_move_type: 1,\r\n        step: [\r\n            [-1, -1, -1, 0, 0, 1, 1, 1],\r\n            [-1, 0, 1, -1, 1, -1, 0, 1]\r\n        ],\r\n    },\r\n    \"118\": {\r\n        second_move_type: 2,\r\n        step: [],\r\n    },\r\n    \"119\": {\r\n        second_move_type: 2,\r\n        step: [],\r\n    },\r\n};\r\n/**\r\n   * function move\r\n   * 現局面(pieces、マスの座標から、移動先をcg.Key型の配列で返します。\r\n   * {key:\"a2\" => cg.Pos:[\"a3\", \"a4\"]}\r\n   *\r\n*/\r\nfunction legalMove(pieces, key) {\r\n    //戻り値\r\n    var pos2 = new Array();\r\n    var piece = pieces[key], pos = _util__WEBPACK_IMPORTED_MODULE_0__[\"key2pos\"](key), x = pos[0], y = pos[1];\r\n    var dx; //横の変化量\r\n    var dy; //縦の変化量\r\n    var xx; //移動先の座標x\r\n    var yy; //移動先の座標y\r\n    // 歩く動き\r\n    if (CHUSHOGI_PIECES[piece.role][\"step\"].length) {\r\n        dx = CHUSHOGI_PIECES[piece.role][\"step\"][0];\r\n        dy = CHUSHOGI_PIECES[piece.role][\"step\"][1];\r\n        for (var i = 0; i < dx.length; i++) {\r\n            xx = (piece.color === \"black\" ? x - dx[i] : x + dx[i]);\r\n            yy = (piece.color === \"black\" ? y - dy[i] : y + dy[i]);\r\n            //盤の範囲\r\n            if (0 <= xx && xx < _types__WEBPACK_IMPORTED_MODULE_1__[\"size\"] && 0 <= yy && yy < _types__WEBPACK_IMPORTED_MODULE_1__[\"size\"]) {\r\n                var dest_key = _util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"]([xx, yy]);\r\n                var target_piece = pieces[dest_key];\r\n                //味方の駒でなければ\r\n                if (!target_piece || target_piece.color !== piece.color) {\r\n                    pos2.push(dest_key);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    // 走る動き\r\n    if (CHUSHOGI_PIECES[piece.role][\"run\"].length) {\r\n        dx = CHUSHOGI_PIECES[piece.role][\"run\"][0];\r\n        dy = CHUSHOGI_PIECES[piece.role][\"run\"][1];\r\n        for (var i = 0; i < dx.length; ++i) {\r\n            xx = x - dx[i];\r\n            yy = piece.color === \"black\" ? y - dy[i] : y + dy[i];\r\n            //盤の端まで繰り返す\r\n            while (0 <= xx && xx < _types__WEBPACK_IMPORTED_MODULE_1__[\"size\"] && 0 <= yy && yy < _types__WEBPACK_IMPORTED_MODULE_1__[\"size\"]) {\r\n                var dest_key = _util__WEBPACK_IMPORTED_MODULE_0__[\"pos2key\"]([xx, yy]);\r\n                var target_piece = pieces[dest_key];\r\n                if (dest_key) {\r\n                    //味方の駒が射線上にある時\r\n                    if (target_piece) {\r\n                        if (target_piece.color !== piece.color) {\r\n                            pos2.push(dest_key);\r\n                            break;\r\n                        }\r\n                        else if (target_piece.color === piece.color) {\r\n                            break;\r\n                        }\r\n                    }\r\n                    else {\r\n                        pos2.push(dest_key);\r\n                    }\r\n                }\r\n                xx -= dx[i];\r\n                yy = piece.color === \"black\" ? yy - dy[i] : yy + dy[i];\r\n            }\r\n        }\r\n    }\r\n    return pos2;\r\n}\r\n\n\n//# sourceURL=webpack:///./src/move.ts?");

/***/ }),

/***/ "./src/premove.ts":
/*!************************!*\
  !*** ./src/premove.ts ***!
  \************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"default\", function() { return premove; });\n/* harmony import */ var _util__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./util */ \"./src/util.ts\");\n\r\nfunction diff(a, b) {\r\n    return Math.abs(a - b);\r\n}\r\nfunction pawn(color) {\r\n    return function (x1, y1, x2, y2) { return diff(x1, x2) < 2 && (color === 'white' ? (\r\n    // allow 2 squares from 1 and 8, for horde\r\n    y2 === y1 + 1 || (y1 <= 2 && y2 === (y1 + 2) && x1 === x2)) : (y2 === y1 - 1 || (y1 >= 7 && y2 === (y1 - 2) && x1 === x2))); };\r\n}\r\nvar knight = function (x1, y1, x2, y2) {\r\n    var xd = diff(x1, x2);\r\n    var yd = diff(y1, y2);\r\n    return (xd === 1 && yd === 2) || (xd === 2 && yd === 1);\r\n};\r\nvar bishop = function (x1, y1, x2, y2) {\r\n    return diff(x1, x2) === diff(y1, y2);\r\n};\r\nvar rook = function (x1, y1, x2, y2) {\r\n    return x1 === x2 || y1 === y2;\r\n};\r\nvar queen = function (x1, y1, x2, y2) {\r\n    return bishop(x1, y1, x2, y2) || rook(x1, y1, x2, y2);\r\n};\r\nfunction king(color, rookFiles, canCastle) {\r\n    return function (x1, y1, x2, y2) { return (diff(x1, x2) < 2 && diff(y1, y2) < 2) || (canCastle && y1 === y2 && y1 === (color === 'white' ? 1 : 8) && ((x1 === 5 && ((_util__WEBPACK_IMPORTED_MODULE_0__[\"containsX\"](rookFiles, 1) && x2 === 3) || (_util__WEBPACK_IMPORTED_MODULE_0__[\"containsX\"](rookFiles, 8) && x2 === 7))) ||\r\n        _util__WEBPACK_IMPORTED_MODULE_0__[\"containsX\"](rookFiles, x2))); };\r\n}\r\nfunction rookFilesOf(pieces, color) {\r\n    var backrank = color == 'white' ? '1' : '8';\r\n    return Object.keys(pieces).filter(function (key) {\r\n        var piece = pieces[key];\r\n        return key[1] === backrank && piece && piece.color === color; // && piece.role === 'rook';\r\n    }).map(function (key) { return _util__WEBPACK_IMPORTED_MODULE_0__[\"key2pos\"](key)[0]; });\r\n}\r\nvar allPos = _util__WEBPACK_IMPORTED_MODULE_0__[\"allKeys\"].map(_util__WEBPACK_IMPORTED_MODULE_0__[\"key2pos\"]);\r\nfunction premove(pieces, key, canCastle) {\r\n    var piece = pieces[key], pos = _util__WEBPACK_IMPORTED_MODULE_0__[\"key2pos\"](key), r = piece.role;\r\n    /*\r\n    mobility: Mobility;/* = r === 'pawn' ? pawn(piece.color) : (\r\n      r === 'knight' ? knight : (\r\n        r === 'bishop' ? bishop : (\r\n          r === 'rook' ? rook : (\r\n            r === 'queen' ? queen : king(piece.color, rookFilesOf(pieces, piece.color), canCastle)\r\n          ))));*/\r\n    return; /*allPos.filter(pos2 =>\r\n      (pos[0] !== pos2[0] || pos[1] !== pos2[1]) //&& mobility(pos[0], pos[1], pos2[0], pos2[1])\r\n    ).map(util.pos2key);*/\r\n}\r\n;\r\n\n\n//# sourceURL=webpack:///./src/premove.ts?");

/***/ }),

/***/ "./src/render.ts":
/*!***********************!*\
  !*** ./src/render.ts ***!
  \***********************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"default\", function() { return render; });\n/* harmony import */ var _board__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./board */ \"./src/board.ts\");\n/* harmony import */ var _util__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./util */ \"./src/util.ts\");\n\r\n\r\nfunction render(s) {\r\n    var asWhite = Object(_board__WEBPACK_IMPORTED_MODULE_0__[\"whitePov\"])(s), posToTranslate = _util__WEBPACK_IMPORTED_MODULE_1__[\"posToTranslateAbs\"](s.dom.bounds()), translate = _util__WEBPACK_IMPORTED_MODULE_1__[\"translateAbs\"], pieces = s.pieces, curAnim = s.animation.current, anims = curAnim ? curAnim.plan.anims : {}, fadings = curAnim ? curAnim.plan.fadings : {}, curDrag = s.draggable.current, samePieces = {}, sameSquares = {}, movedPieces = {}, movedSquares = {}, squares = computeSquareClasses(s), piecesKeys = Object.keys(pieces);\r\n    var boardEl = s.dom.elements.board, k, p, el, pieceAtKey, elPieceName, anim, fading, pMvdset, //直前に動いたマスの自分版？\r\n    pMvd, //直前に動いたマス相手版？\r\n    sMvdset, //現在動いたマスの自分版？\r\n    sMvd; //現在動いたマスの相手版？\r\n    el = boardEl.firstChild;\r\n    //駒の動きに関するセクション\r\n    while (el) {\r\n        k = el.cgKey;\r\n        if (isPieceNode(el)) {\r\n            pieceAtKey = pieces[k];\r\n            anim = anims[k];\r\n            fading = fadings[k];\r\n            elPieceName = el.cgPiece;\r\n            if (el.cgDragging && (!curDrag || curDrag.orig !== k)) {\r\n                el.classList.remove('dragging');\r\n                translate(el, posToTranslate(_util__WEBPACK_IMPORTED_MODULE_1__[\"key2pos\"](k), asWhite));\r\n                el.cgDragging = false;\r\n            }\r\n            //fadingも同様\r\n            // remove fading class if it still remains\r\n            if (!fading && el.cgFading) {\r\n                el.cgFading = false;\r\n                el.classList.remove('fading');\r\n            }\r\n            // there is now a piece at this dom key\r\n            if (pieceAtKey) {\r\n                // continue animation if already animating and same piece\r\n                // (otherwise it could animate a captured piece)\r\n                if (anim && el.cgAnimating && elPieceName === pieceNameOf(pieceAtKey)) {\r\n                    var pos = _util__WEBPACK_IMPORTED_MODULE_1__[\"key2pos\"](k);\r\n                    pos[0] += anim[2];\r\n                    pos[1] += anim[3];\r\n                    el.classList.add('anim');\r\n                    translate(el, posToTranslate(pos, asWhite));\r\n                }\r\n                else if (el.cgAnimating) {\r\n                    el.cgAnimating = false;\r\n                    el.classList.remove('anim');\r\n                    translate(el, posToTranslate(_util__WEBPACK_IMPORTED_MODULE_1__[\"key2pos\"](k), asWhite));\r\n                    //if (s.addPieceZIndex) el.style.zIndex = posZIndex(util.key2pos(k), asWhite);\r\n                }\r\n                // same piece: flag as same\r\n                if (elPieceName === pieceNameOf(pieceAtKey) && (!fading || !el.cgFading)) {\r\n                    samePieces[k] = true;\r\n                }\r\n                // different piece: flag as moved unless it is a fading piece\r\n                else {\r\n                    if (fading && elPieceName === pieceNameOf(fading)) {\r\n                        el.classList.add('fading');\r\n                        el.cgFading = true;\r\n                    }\r\n                    else {\r\n                        if (movedPieces[elPieceName])\r\n                            movedPieces[elPieceName].push(el);\r\n                        else\r\n                            movedPieces[elPieceName] = [el];\r\n                    }\r\n                }\r\n            }\r\n            // no piece: flag as moved\r\n            else {\r\n                if (movedPieces[elPieceName])\r\n                    movedPieces[elPieceName].push(el);\r\n                else\r\n                    movedPieces[elPieceName] = [el];\r\n            }\r\n        }\r\n        else if (isSquareNode(el)) {\r\n            var cn = el.className;\r\n            if (squares[k] === cn)\r\n                sameSquares[k] = true;\r\n            else if (movedSquares[cn])\r\n                movedSquares[cn].push(el);\r\n            else\r\n                movedSquares[cn] = [el];\r\n        }\r\n        el = el.nextSibling;\r\n    }\r\n    // squareノード (lastMoveを示すのに使われる)\r\n    for (var sk in squares) {\r\n        // 同じマスでないことが条件\r\n        if (!sameSquares[sk]) {\r\n            sMvdset = movedSquares[squares[sk]];\r\n            sMvd = sMvdset && sMvdset.pop();\r\n            var translation = posToTranslate(_util__WEBPACK_IMPORTED_MODULE_1__[\"key2pos\"](sk), asWhite);\r\n            //自分の動いたマスであれば、\r\n            if (sMvd) {\r\n                sMvd.cgKey = sk;\r\n                translate(sMvd, translation);\r\n            }\r\n            //そうでなければ、\r\n            else {\r\n                var squareNode = _util__WEBPACK_IMPORTED_MODULE_1__[\"createEl\"]('square', squares[sk]);\r\n                squareNode.cgKey = sk;\r\n                translate(squareNode, translation);\r\n                boardEl.insertBefore(squareNode, boardEl.firstChild);\r\n            }\r\n        }\r\n    }\r\n    for (var j in piecesKeys) {\r\n        k = piecesKeys[j];\r\n        p = pieces[k];\r\n        anim = anims[k];\r\n        if (!samePieces[k]) {\r\n            pMvdset = movedPieces[pieceNameOf(p)];\r\n            pMvd = pMvdset && pMvdset.pop();\r\n            // a same piece was moved\r\n            if (pMvd) {\r\n                // apply dom changes\r\n                pMvd.cgKey = k;\r\n                if (pMvd.cgFading) {\r\n                    pMvd.classList.remove('fading');\r\n                    pMvd.cgFading = false;\r\n                }\r\n                var pos = _util__WEBPACK_IMPORTED_MODULE_1__[\"key2pos\"](k);\r\n                //if (s.addPieceZIndex) pMvd.style.zIndex = posZIndex(pos, asWhite);\r\n                if (anim) {\r\n                    pMvd.cgAnimating = true;\r\n                    pMvd.classList.add('anim');\r\n                    pos[0] += anim[2];\r\n                    pos[1] += anim[3];\r\n                }\r\n                translate(pMvd, posToTranslate(pos, asWhite));\r\n            }\r\n            // no piece in moved obj: insert the new piece\r\n            // assumes the new piece is not being dragged\r\n            else {\r\n                var pieceName = pieceNameOf(p), pieceNode = _util__WEBPACK_IMPORTED_MODULE_1__[\"createEl\"]('piece', pieceName), pos = _util__WEBPACK_IMPORTED_MODULE_1__[\"key2pos\"](k);\r\n                pieceNode.cgPiece = pieceName;\r\n                pieceNode.cgKey = k;\r\n                if (anim) {\r\n                    pieceNode.cgAnimating = true;\r\n                    pos[0] += anim[2];\r\n                    pos[1] += anim[3];\r\n                }\r\n                translate(pieceNode, posToTranslate(pos, asWhite));\r\n                //if (s.addPieceZIndex) pieceNode.style.zIndex = posZIndex(pos, asWhite);\r\n                boardEl.appendChild(pieceNode);\r\n            }\r\n        }\r\n    }\r\n    // remove any element that remains in the moved sets\r\n    //駒を取り除く場合 ？\r\n    for (var i in movedPieces)\r\n        removeNodes(s, movedPieces[i]);\r\n    //駒を動かした場合？\r\n    for (var i in movedSquares)\r\n        removeNodes(s, movedSquares[i]);\r\n}\r\nfunction isPieceNode(el) {\r\n    return el.tagName === 'PIECE';\r\n}\r\nfunction isSquareNode(el) {\r\n    return el.tagName === 'SQUARE';\r\n}\r\nfunction pieceNameOf(piece) {\r\n    return piece.color + \" piece_\" + piece.role;\r\n}\r\nfunction removeNodes(s, nodes) {\r\n    for (var i in nodes)\r\n        s.dom.elements.board.removeChild(nodes[i]);\r\n}\r\nfunction computeSquareClasses(s) {\r\n    var squares = {};\r\n    var i, k;\r\n    if (s.lastMove && s.highlight.lastMove)\r\n        for (i in s.lastMove) {\r\n            addSquare(squares, s.lastMove[i], 'last-move');\r\n        }\r\n    if (s.check && s.highlight.check)\r\n        addSquare(squares, s.check, 'check');\r\n    if (s.selected) {\r\n        addSquare(squares, s.selected, 'selected');\r\n        if (s.movable.showDests) {\r\n            var dests = s.movable.dests && s.movable.dests[s.selected];\r\n            if (dests)\r\n                for (i in dests) {\r\n                    k = dests[i];\r\n                    addSquare(squares, k, 'move-dest' + (s.pieces[k] ? ' oc' : ''));\r\n                }\r\n            var pDests = s.premovable.dests;\r\n            if (pDests)\r\n                for (i in pDests) {\r\n                    k = pDests[i];\r\n                    addSquare(squares, k, 'premove-dest' + (s.pieces[k] ? ' oc' : ''));\r\n                }\r\n        }\r\n    }\r\n    var premove = s.premovable.current;\r\n    if (premove)\r\n        for (i in premove)\r\n            addSquare(squares, premove[i], 'current-premove');\r\n    else if (s.predroppable.current)\r\n        addSquare(squares, s.predroppable.current.key, 'current-premove');\r\n    /*\r\n      const o = s.exploding;\r\n      if (o) for (i in o.keys) addSquare(squares, o.keys[i], 'exploding' + o.stage);\r\n    */\r\n    return squares;\r\n}\r\nfunction addSquare(squares, key, klass) {\r\n    if (squares[key])\r\n        squares[key] += ' ' + klass;\r\n    else\r\n        squares[key] = klass;\r\n}\r\n\n\n//# sourceURL=webpack:///./src/render.ts?");

/***/ }),

/***/ "./src/state.ts":
/*!**********************!*\
  !*** ./src/state.ts ***!
  \**********************/
/*! exports provided: defaults */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"defaults\", function() { return defaults; });\n/* harmony import */ var _fen__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./fen */ \"./src/fen.ts\");\n/* harmony import */ var _util__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./util */ \"./src/util.ts\");\n\r\n\r\nfunction defaults() {\r\n    return {\r\n        pieces: _fen__WEBPACK_IMPORTED_MODULE_0__[\"chushogi_read\"](),\r\n        orientation: 'white',\r\n        turnColor: 'white',\r\n        coordinates: true,\r\n        viewOnly: false,\r\n        highlight: {\r\n            lastMove: true,\r\n            check: true\r\n        },\r\n        draggable: {\r\n            enabled: true,\r\n            distance: 3,\r\n            autoDistance: true,\r\n            centerPiece: true,\r\n            showGhost: true,\r\n            deleteOnDropOff: false\r\n        },\r\n        animation: {\r\n            enabled: true,\r\n            duration: 200\r\n        },\r\n        movable: {\r\n            free: true,\r\n            color: 'white',\r\n            showDests: true,\r\n            events: {},\r\n            rookCastle: true\r\n        },\r\n        selectable: {\r\n            enabled: true\r\n        },\r\n        premovable: {\r\n            enabled: true,\r\n            showDests: true,\r\n            castle: true,\r\n            events: {}\r\n        },\r\n        predroppable: {\r\n            enabled: false,\r\n            events: {}\r\n        },\r\n        stats: {\r\n            // on touchscreen, default to \"tap-tap\" moves\r\n            // instead of drag\r\n            dragged: !('ontouchstart' in window)\r\n        },\r\n        events: {},\r\n        drawable: {\r\n            enabled: true,\r\n            visible: true,\r\n            eraseOnClick: true,\r\n            shapes: [],\r\n            autoShapes: [],\r\n            brushes: {\r\n                green: { key: 'g', color: '#15781B', opacity: 1, lineWidth: 10 },\r\n                red: { key: 'r', color: '#882020', opacity: 1, lineWidth: 10 },\r\n                blue: { key: 'b', color: '#003088', opacity: 1, lineWidth: 10 },\r\n                yellow: { key: 'y', color: '#e68f00', opacity: 1, lineWidth: 10 },\r\n                paleBlue: { key: 'pb', color: '#003088', opacity: 0.4, lineWidth: 15 },\r\n                paleGreen: { key: 'pg', color: '#15781B', opacity: 0.4, lineWidth: 15 },\r\n                paleRed: { key: 'pr', color: '#882020', opacity: 0.4, lineWidth: 15 },\r\n                paleGrey: { key: 'pgr', color: '#4a4a4a', opacity: 0.35, lineWidth: 15 }\r\n            },\r\n            pieces: {\r\n                baseUrl: ''\r\n            },\r\n            prevSvgHash: ''\r\n        },\r\n        dropmode: {\r\n            active: false,\r\n        },\r\n        hold: Object(_util__WEBPACK_IMPORTED_MODULE_1__[\"timer\"])()\r\n    };\r\n}\r\n\n\n//# sourceURL=webpack:///./src/state.ts?");

/***/ }),

/***/ "./src/svg.ts":
/*!********************!*\
  !*** ./src/svg.ts ***!
  \********************/
/*! exports provided: createElement, renderSvg */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"createElement\", function() { return createElement; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"renderSvg\", function() { return renderSvg; });\n/* harmony import */ var _util__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./util */ \"./src/util.ts\");\n/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./types */ \"./src/types.ts\");\n\r\n\r\nfunction createElement(tagName) {\r\n    return document.createElementNS('http://www.w3.org/2000/svg', tagName);\r\n}\r\nfunction renderSvg(state, root) {\r\n    var d = state.drawable, curD = d.current, cur = curD && curD.mouseSq ? curD : undefined, arrowDests = {};\r\n    d.shapes.concat(d.autoShapes).concat(cur ? [cur] : []).forEach(function (s) {\r\n        if (s.dest)\r\n            arrowDests[s.dest] = (arrowDests[s.dest] || 0) + 1;\r\n    });\r\n    var shapes = d.shapes.concat(d.autoShapes).map(function (s) {\r\n        return {\r\n            shape: s,\r\n            current: false,\r\n            hash: shapeHash(s, arrowDests, false)\r\n        };\r\n    });\r\n    if (cur)\r\n        shapes.push({\r\n            shape: cur,\r\n            current: true,\r\n            hash: shapeHash(cur, arrowDests, true)\r\n        });\r\n    var fullHash = shapes.map(function (sc) { return sc.hash; }).join('');\r\n    if (fullHash === state.drawable.prevSvgHash)\r\n        return;\r\n    state.drawable.prevSvgHash = fullHash;\r\n    var defsEl = root.firstChild;\r\n    syncDefs(d, shapes, defsEl);\r\n    syncShapes(state, shapes, d.brushes, arrowDests, root, defsEl);\r\n}\r\n// append only. Don't try to update/remove.\r\nfunction syncDefs(d, shapes, defsEl) {\r\n    var brushes = {};\r\n    var brush;\r\n    shapes.forEach(function (s) {\r\n        if (s.shape.dest) {\r\n            brush = d.brushes[s.shape.brush];\r\n            if (s.shape.modifiers)\r\n                brush = makeCustomBrush(brush, s.shape.modifiers);\r\n            brushes[brush.key] = brush;\r\n        }\r\n    });\r\n    var keysInDom = {};\r\n    var el = defsEl.firstChild;\r\n    while (el) {\r\n        keysInDom[el.getAttribute('cgKey')] = true;\r\n        el = el.nextSibling;\r\n    }\r\n    for (var key in brushes) {\r\n        if (!keysInDom[key])\r\n            defsEl.appendChild(renderMarker(brushes[key]));\r\n    }\r\n}\r\n// append and remove only. No updates.\r\nfunction syncShapes(state, shapes, brushes, arrowDests, root, defsEl) {\r\n    var bounds = state.dom.bounds(), hashesInDom = {}, toRemove = [];\r\n    shapes.forEach(function (sc) { hashesInDom[sc.hash] = false; });\r\n    var el = defsEl.nextSibling, elHash;\r\n    while (el) {\r\n        elHash = el.getAttribute('cgHash');\r\n        // found a shape element that's here to stay\r\n        if (hashesInDom.hasOwnProperty(elHash))\r\n            hashesInDom[elHash] = true;\r\n        // or remove it\r\n        else\r\n            toRemove.push(el);\r\n        el = el.nextSibling;\r\n    }\r\n    // remove old shapes\r\n    toRemove.forEach(function (el) { return root.removeChild(el); });\r\n    // insert shapes that are not yet in dom\r\n    shapes.forEach(function (sc) {\r\n        if (!hashesInDom[sc.hash])\r\n            root.appendChild(renderShape(state, sc, brushes, arrowDests, bounds));\r\n    });\r\n}\r\nfunction shapeHash(_a, arrowDests, current) {\r\n    var orig = _a.orig, dest = _a.dest, brush = _a.brush, piece = _a.piece, modifiers = _a.modifiers;\r\n    return [current, orig, dest, brush, dest && arrowDests[dest] > 1,\r\n        piece && pieceHash(piece),\r\n        modifiers && modifiersHash(modifiers)\r\n    ].filter(function (x) { return x; }).join('');\r\n}\r\nfunction pieceHash(piece) {\r\n    return [piece.color, piece.role, piece.scale].filter(function (x) { return x; }).join('');\r\n}\r\nfunction modifiersHash(m) {\r\n    return '' + (m.lineWidth || '');\r\n}\r\nfunction renderShape(state, _a, brushes, arrowDests, bounds) {\r\n    var shape = _a.shape, current = _a.current, hash = _a.hash;\r\n    var el;\r\n    if (shape.piece)\r\n        el = renderPiece(state.drawable.pieces.baseUrl, orient(Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"key2pos\"])(shape.orig), state.orientation), shape.piece, bounds);\r\n    else {\r\n        var orig = orient(Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"key2pos\"])(shape.orig), state.orientation);\r\n        if (shape.orig && shape.dest) {\r\n            var brush = brushes[shape.brush];\r\n            if (shape.modifiers)\r\n                brush = makeCustomBrush(brush, shape.modifiers);\r\n            el = renderArrow(brush, orig, orient(Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"key2pos\"])(shape.dest), state.orientation), current, arrowDests[shape.dest] > 1, bounds);\r\n        }\r\n        else\r\n            el = renderCircle(brushes[shape.brush], orig, current, bounds);\r\n    }\r\n    el.setAttribute('cgHash', hash);\r\n    return el;\r\n}\r\nfunction renderCircle(brush, pos, current, bounds) {\r\n    var o = pos2px(pos, bounds), widths = circleWidth(bounds), radius = (bounds.width + bounds.height) / (_types__WEBPACK_IMPORTED_MODULE_1__[\"size\"] * 4.5);\r\n    return setAttributes(createElement('circle'), {\r\n        stroke: brush.color,\r\n        'stroke-width': widths[current ? 0 : 1],\r\n        fill: 'none',\r\n        opacity: opacity(brush, current),\r\n        cx: o[0] + ((_types__WEBPACK_IMPORTED_MODULE_1__[\"size\"] % 2) / 2),\r\n        cy: o[1] + ((_types__WEBPACK_IMPORTED_MODULE_1__[\"size\"] % 2) / 2),\r\n        r: radius - widths[1] / 2\r\n    });\r\n}\r\nfunction renderArrow(brush, orig, dest, current, shorten, bounds) {\r\n    var m = arrowMargin(bounds, shorten && !current), a = pos2px(orig, bounds), b = pos2px(dest, bounds), dx = b[0] - a[0], dy = b[1] - a[1], angle = Math.atan2(dy, dx), xo = Math.cos(angle) * m, yo = Math.sin(angle) * m;\r\n    return setAttributes(createElement('line'), {\r\n        stroke: brush.color,\r\n        'stroke-width': lineWidth(brush, current, bounds),\r\n        'stroke-linecap': 'round',\r\n        'marker-end': 'url(#arrowhead-' + brush.key + ')',\r\n        opacity: opacity(brush, current),\r\n        x1: a[0] + ((_types__WEBPACK_IMPORTED_MODULE_1__[\"size\"] % 2) / 2),\r\n        y1: a[1] + ((_types__WEBPACK_IMPORTED_MODULE_1__[\"size\"] % 2) / 2),\r\n        x2: b[0] - xo + ((_types__WEBPACK_IMPORTED_MODULE_1__[\"size\"] % 2) / 2),\r\n        y2: b[1] - yo + ((_types__WEBPACK_IMPORTED_MODULE_1__[\"size\"] % 2) / 2)\r\n    });\r\n}\r\nfunction renderPiece(baseUrl, pos, piece, bounds) {\r\n    var o = pos2px(pos, bounds), size = bounds.width / _types__WEBPACK_IMPORTED_MODULE_1__[\"size\"] * (piece.scale || 1), name = piece.color[0]; // + (piece.role === 'knight' ? 'n' : piece.role[0]).toUpperCase();\r\n    return setAttributes(createElement('image'), {\r\n        className: piece.role + \" \" + piece.color,\r\n        x: o[0] - size / 2,\r\n        y: o[1] - size / 2,\r\n        width: size,\r\n        height: size,\r\n        href: baseUrl + name + '.svg'\r\n    });\r\n}\r\nfunction renderMarker(brush) {\r\n    var marker = setAttributes(createElement('marker'), {\r\n        id: 'arrowhead-' + brush.key,\r\n        orient: 'auto',\r\n        markerWidth: 4,\r\n        markerHeight: 8,\r\n        refX: 2.05,\r\n        refY: 2.01\r\n    });\r\n    marker.appendChild(setAttributes(createElement('path'), {\r\n        d: 'M0,0 V4 L3,2 Z',\r\n        fill: brush.color\r\n    }));\r\n    marker.setAttribute('cgKey', brush.key);\r\n    return marker;\r\n}\r\nfunction setAttributes(el, attrs) {\r\n    for (var key in attrs)\r\n        el.setAttribute(key, attrs[key]);\r\n    return el;\r\n}\r\nfunction orient(pos, color) {\r\n    return color === 'white' ? pos : [(_types__WEBPACK_IMPORTED_MODULE_1__[\"size\"] + 1) - pos[0], (_types__WEBPACK_IMPORTED_MODULE_1__[\"size\"] + 1) - pos[1]];\r\n}\r\nfunction makeCustomBrush(base, modifiers) {\r\n    var brush = {\r\n        color: base.color,\r\n        opacity: Math.round(base.opacity * 10) / 10,\r\n        lineWidth: Math.round(modifiers.lineWidth || base.lineWidth)\r\n    };\r\n    brush.key = [base.key, modifiers.lineWidth].filter(function (x) { return x; }).join('');\r\n    return brush;\r\n}\r\nfunction circleWidth(bounds) {\r\n    var base = bounds.width / 550;\r\n    return [3 * base, 4 * base];\r\n}\r\nfunction lineWidth(brush, current, bounds) {\r\n    return (brush.lineWidth || 10) * (current ? 0.85 : 1) / 550 * bounds.width;\r\n}\r\nfunction opacity(brush, current) {\r\n    return (brush.opacity || 1) * (current ? 0.9 : 1);\r\n}\r\nfunction arrowMargin(bounds, shorten) {\r\n    return (shorten ? 20 : 10) / 550 * bounds.width;\r\n}\r\nfunction pos2px(pos, bounds) {\r\n    return [(pos[0] - 0.5) * bounds.width / _types__WEBPACK_IMPORTED_MODULE_1__[\"size\"], ((_types__WEBPACK_IMPORTED_MODULE_1__[\"size\"] + 0.5) - pos[1]) * bounds.height / _types__WEBPACK_IMPORTED_MODULE_1__[\"size\"]];\r\n}\r\n\n\n//# sourceURL=webpack:///./src/svg.ts?");

/***/ }),

/***/ "./src/types.ts":
/*!**********************!*\
  !*** ./src/types.ts ***!
  \**********************/
/*! exports provided: size, files, ranks */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"size\", function() { return size; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"files\", function() { return files; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ranks\", function() { return ranks; });\nvar size = 12;\r\nvar files = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l'];\r\nvar ranks = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12];\r\n\n\n//# sourceURL=webpack:///./src/types.ts?");

/***/ }),

/***/ "./src/util.ts":
/*!*********************!*\
  !*** ./src/util.ts ***!
  \*********************/
/*! exports provided: invRanks, allKeys, pos2key, colors, key2pos, memo, containsX, opposite, timer, posToTranslateBase, translateAbs, translateRel, posToTranslateRel, posToTranslateAbs, distanceSq, samePiece, eventPosition, setVisible, isRightButton, createEl */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"invRanks\", function() { return invRanks; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"allKeys\", function() { return allKeys; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"pos2key\", function() { return pos2key; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"colors\", function() { return colors; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"key2pos\", function() { return key2pos; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"memo\", function() { return memo; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"containsX\", function() { return containsX; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"opposite\", function() { return opposite; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"timer\", function() { return timer; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"posToTranslateBase\", function() { return posToTranslateBase; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"translateAbs\", function() { return translateAbs; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"translateRel\", function() { return translateRel; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"posToTranslateRel\", function() { return posToTranslateRel; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"posToTranslateAbs\", function() { return posToTranslateAbs; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"distanceSq\", function() { return distanceSq; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"samePiece\", function() { return samePiece; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"eventPosition\", function() { return eventPosition; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"setVisible\", function() { return setVisible; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"isRightButton\", function() { return isRightButton; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"createEl\", function() { return createEl; });\n/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./types */ \"./src/types.ts\");\nvar _a;\r\n\r\nvar invRanks = [8, 7, 6, 5, 4, 3, 2, 1];\r\nvar allKeys = (_a = Array.prototype).concat.apply(_a, _types__WEBPACK_IMPORTED_MODULE_0__[\"files\"].map(function (c) { return _types__WEBPACK_IMPORTED_MODULE_0__[\"ranks\"].map(function (r) { return c + r; }); }));\r\nvar pos2key = function (pos) { return allKeys[_types__WEBPACK_IMPORTED_MODULE_0__[\"size\"] * pos[0] + pos[1] - (_types__WEBPACK_IMPORTED_MODULE_0__[\"size\"] + 1)]; };\r\nvar colors = ['white', 'black'];\r\n//export const key2pos = (k: cg.Key) => [k.charCodeAt(0) - 96, k.charCodeAt(1) - 48] as cg.Pos;\r\nvar key2pos = function (k) { return [k.charCodeAt(0) - 96, parseInt(k.substr(1))]; };\r\nfunction memo(f) {\r\n    var v;\r\n    var ret = function () {\r\n        if (v === undefined)\r\n            v = f();\r\n        return v;\r\n    };\r\n    ret.clear = function () { v = undefined; };\r\n    return ret;\r\n}\r\nfunction containsX(xs, x) {\r\n    return xs !== undefined && xs.indexOf(x) !== -1;\r\n}\r\nvar opposite = function (c) { return c === 'white' ? 'black' : 'white'; };\r\nvar timer = function () {\r\n    var startAt;\r\n    return {\r\n        start: function () { startAt = performance.now(); },\r\n        cancel: function () { startAt = undefined; },\r\n        stop: function () {\r\n            if (!startAt)\r\n                return 0;\r\n            var time = performance.now() - startAt;\r\n            startAt = undefined;\r\n            return time;\r\n        }\r\n    };\r\n};\r\nvar posToTranslateBase = function (pos, asWhite, xFactor, yFactor) { return [\r\n    (asWhite ? pos[0] - 1 : _types__WEBPACK_IMPORTED_MODULE_0__[\"size\"] - pos[0]) * xFactor,\r\n    (asWhite ? _types__WEBPACK_IMPORTED_MODULE_0__[\"size\"] - pos[1] : pos[1] - 1) * yFactor\r\n]; };\r\nvar translateAbs = function (el, pos) {\r\n    el.style.transform = \"translate(\" + pos[0] + \"px,\" + pos[1] + \"px)\";\r\n};\r\nvar translateRel = function (el, percents) {\r\n    el.style.transform = \"translate(\" + percents[0] + \"%,\" + percents[1] + \"%)\";\r\n};\r\nvar posToTranslateRel = function (pos, asWhite) { return posToTranslateBase(pos, asWhite, 100, 100); };\r\nvar posToTranslateAbs = function (bounds) {\r\n    var xFactor = bounds.width / _types__WEBPACK_IMPORTED_MODULE_0__[\"size\"], yFactor = bounds.height / _types__WEBPACK_IMPORTED_MODULE_0__[\"size\"];\r\n    return function (pos, asWhite) { return posToTranslateBase(pos, asWhite, xFactor, yFactor); };\r\n};\r\nvar distanceSq = function (pos1, pos2) {\r\n    return Math.pow(pos1[0] - pos2[0], 2) + Math.pow(pos1[1] - pos2[1], 2);\r\n};\r\nvar samePiece = function (p1, p2) {\r\n    return p1.role === p2.role && p1.color === p2.color;\r\n};\r\nvar eventPosition = function (e) {\r\n    if (e.clientX || e.clientX === 0)\r\n        return [e.clientX, e.clientY];\r\n    if (e.touches && e.targetTouches[0])\r\n        return [e.targetTouches[0].clientX, e.targetTouches[0].clientY];\r\n    return undefined;\r\n};\r\nvar setVisible = function (el, v) {\r\n    el.style.visibility = v ? 'visible' : 'hidden';\r\n};\r\nvar isRightButton = function (e) { return e.buttons === 2 || e.button === 2; };\r\nvar createEl = function (tagName, className) {\r\n    var el = document.createElement(tagName);\r\n    if (className)\r\n        el.className = className;\r\n    return el;\r\n};\r\n\n\n//# sourceURL=webpack:///./src/util.ts?");

/***/ }),

/***/ "./src/wrap.ts":
/*!*********************!*\
  !*** ./src/wrap.ts ***!
  \*********************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"default\", function() { return renderWrap; });\n/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./types */ \"./src/types.ts\");\n/* harmony import */ var _util__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./util */ \"./src/util.ts\");\n/* harmony import */ var _svg__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./svg */ \"./src/svg.ts\");\n\r\n\r\n\r\nfunction renderWrap(element, s, relative) {\r\n    element.innerHTML = '';\r\n    // ensure the cg-wrap class is set\r\n    // so bounds calculation can use the CSS width/height values\r\n    // add that class yourself to the element before calling chessground\r\n    // for a slight performance improvement! (avoids recomputing style)\r\n    element.classList.add('cg-wrap');\r\n    _util__WEBPACK_IMPORTED_MODULE_1__[\"colors\"].forEach(function (c) { return element.classList.toggle('orientation-' + c, s.orientation === c); });\r\n    element.classList.toggle('manipulable', !s.viewOnly);\r\n    var helper = Object(_util__WEBPACK_IMPORTED_MODULE_1__[\"createEl\"])('cg-helper');\r\n    element.appendChild(helper);\r\n    var container = Object(_util__WEBPACK_IMPORTED_MODULE_1__[\"createEl\"])('cg-container');\r\n    helper.appendChild(container);\r\n    var board = Object(_util__WEBPACK_IMPORTED_MODULE_1__[\"createEl\"])('cg-board');\r\n    container.appendChild(board);\r\n    var svg;\r\n    if (s.drawable.visible && !relative) {\r\n        svg = Object(_svg__WEBPACK_IMPORTED_MODULE_2__[\"createElement\"])('svg');\r\n        svg.appendChild(Object(_svg__WEBPACK_IMPORTED_MODULE_2__[\"createElement\"])('defs'));\r\n        container.appendChild(svg);\r\n    }\r\n    if (s.coordinates) {\r\n        var orientClass = s.orientation === 'black' ? ' black' : '';\r\n        container.appendChild(renderCoords(_types__WEBPACK_IMPORTED_MODULE_0__[\"ranks\"], 'ranks' + orientClass));\r\n        container.appendChild(renderCoords(_types__WEBPACK_IMPORTED_MODULE_0__[\"files\"], 'files' + orientClass));\r\n    }\r\n    var ghost;\r\n    if (s.draggable.showGhost && !relative) {\r\n        ghost = Object(_util__WEBPACK_IMPORTED_MODULE_1__[\"createEl\"])('piece', 'ghost');\r\n        Object(_util__WEBPACK_IMPORTED_MODULE_1__[\"setVisible\"])(ghost, false);\r\n        container.appendChild(ghost);\r\n    }\r\n    return {\r\n        board: board,\r\n        container: container,\r\n        ghost: ghost,\r\n        svg: svg\r\n    };\r\n}\r\nfunction renderCoords(elems, className) {\r\n    var el = Object(_util__WEBPACK_IMPORTED_MODULE_1__[\"createEl\"])('coords', className);\r\n    var f;\r\n    for (var i in elems) {\r\n        f = Object(_util__WEBPACK_IMPORTED_MODULE_1__[\"createEl\"])('coord');\r\n        f.textContent = elems[i];\r\n        el.appendChild(f);\r\n    }\r\n    return el;\r\n}\r\n\n\n//# sourceURL=webpack:///./src/wrap.ts?");

/***/ })

/******/ });